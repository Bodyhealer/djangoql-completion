{"version":3,"sources":["webpack://djangoql-completion/./node_modules/lex/lexer.js","webpack://djangoql-completion/webpack/bootstrap","webpack://djangoql-completion/webpack/runtime/compat get default export","webpack://djangoql-completion/webpack/runtime/define property getters","webpack://djangoql-completion/webpack/runtime/hasOwnProperty shorthand","webpack://djangoql-completion/webpack/runtime/node module decorator","webpack://djangoql-completion/./src/lru-cache.js","webpack://djangoql-completion/./src/index.js"],"names":["Lexer","defunct","tokens","rules","remove","scan","matches","index","state","this","lastIndex","input","i","length","rule","start","states","indexOf","pattern","result","exec","j","push","action","global","k","temple","addRule","flags","multiline","ignoreCase","RegExp","source","Object","prototype","toString","call","setInput","lex","shift","reject","splice","match","token","apply","slice","charAt","module","exports","chr","Error","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","id","loaded","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","defineProperty","enumerable","get","obj","prop","hasOwnProperty","nmd","paths","children","LRUCache","limit","size","oldest","newest","_keymap","_markEntryAsUsed","entry","newer","older","put","value","returnEntry","find","set","oldvalue","removeAll","keys","forEach","fun","context","desc","toJSON","s","Array","String","reIntValue","reExponentPart","intRegex","floatRegex","stringRegex","whitespaceRegex","lexer","name","suggestion","text","snippetBefore","snippetAfter","l","lexAll","end","DjangoQL","options","cacheSize","currentModel","models","suggestionsAPIUrl","prefix","suggestions","selected","valuesCaseSensitive","highlightCaseSensitive","textarea","completion","completionUL","completionEnabled","isObject","loadIntrospections","introspections","selector","document","querySelector","tagName","parseInt","logError","suggestionsCache","debouncedLoadFieldOptions","debounce","loadFieldOptions","bind","loading","enableCompletion","disableCompletion","onCompletionMouseClick","onCompletionMouseDown","popupCompletion","debouncedRenderCompletion","renderCompletion","setAttribute","addEventListener","onKeydown","hideCompletion","autoResize","textareaResize","style","resize","overflow","window","createCompletionElement","init","DOMReady","callback","readyState","syntaxHelp","createElement","className","appendChild","onscroll","throttle","onCompletionScroll","innerHTML","e","preventDefault","destroyCompletionElement","parentNode","removeChild","getJson","url","settings","onLoadError","request","abort","XMLHttpRequest","open","onload","status","success","JSON","parse","responseText","ontimeout","onerror","onprogress","setTimeout","send","initIntrospections","data","current_model","suggestions_api_url","func","wait","immediate","args","timeout","timestamp","later","last","Date","now","callNow","arguments","throttled","previous","leading","getTime","remaining","clearTimeout","trailing","cancel","setUrlParams","params","pair","parts","split","path","queryString","join","pairs","encodeURI","message","console","error","selectCompletion","currentTarget","getAttribute","keyCode","onSubmit","form","submit","getComputedStyle","heightOffset","parseFloat","paddingTop","paddingBottom","height","scrollHeight","generateSuggestions","getContext","selectionStart","currentFullToken","textValue","startPos","tokenEndPos","textBefore","textAfter","trim","snippetAfterParts","endsWith","startsWith","textToPaste","cursorPosAfter","focus","setSelectionRange","display","escapeRegExp","str","replace","highlight","dontForceDisplay","currentLi","completionRect","currentLiRect","inputRect","li","liLen","suggestionsLen","loadingElement","querySelectorAll","getBoundingClientRect","bottom","scrollTop","top","removeEventListener","pageYOffset","left","resolveName","f","nameParts","model","field","type","relation","cursorPos","whitespace","resolvedName","scope","lastToken","nextToLastToken","allTokens","pop","getCurrentFieldOptions","fieldOptions","cacheKey","isArray","loadMore","cached","requestUrl","requestParams","search","has_next","page","items","concat","populateFieldOptions","filter","item","toLowerCase","map","rectHeight","scrollBottom","searchFilter","selectionEnd","lastIndexOf","nullable"],"mappings":"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","file":"completion.js","sourcesContent":["if (typeof module === \"object\" && typeof module.exports === \"object\") module.exports = Lexer;\n\nLexer.defunct = function (chr) {\n    throw new Error(\"Unexpected character at index \" + (this.index - 1) + \": \" + chr);\n};\n\nfunction Lexer(defunct) {\n    if (typeof defunct !== \"function\") defunct = Lexer.defunct;\n\n    var tokens = [];\n    var rules = [];\n    var remove = 0;\n    this.state = 0;\n    this.index = 0;\n    this.input = \"\";\n\n    this.addRule = function (pattern, action, start) {\n        var global = pattern.global;\n\n        if (!global) {\n            var flags = \"g\";\n            if (pattern.multiline) flags += \"m\";\n            if (pattern.ignoreCase) flags += \"i\";\n            pattern = new RegExp(pattern.source, flags);\n        }\n\n        if (Object.prototype.toString.call(start) !== \"[object Array]\") start = [0];\n\n        rules.push({\n            pattern: pattern,\n            global: global,\n            action: action,\n            start: start\n        });\n\n        return this;\n    };\n\n    this.setInput = function (input) {\n        remove = 0;\n        this.state = 0;\n        this.index = 0;\n        tokens.length = 0;\n        this.input = input;\n        return this;\n    };\n\n    this.lex = function () {\n        if (tokens.length) return tokens.shift();\n\n        this.reject = true;\n\n        while (this.index <= this.input.length) {\n            var matches = scan.call(this).splice(remove);\n            var index = this.index;\n\n            while (matches.length) {\n                if (this.reject) {\n                    var match = matches.shift();\n                    var result = match.result;\n                    var length = match.length;\n                    this.index += length;\n                    this.reject = false;\n                    remove++;\n\n                    var token = match.action.apply(this, result);\n                    if (this.reject) this.index = result.index;\n                    else if (typeof token !== \"undefined\") {\n                        switch (Object.prototype.toString.call(token)) {\n                        case \"[object Array]\":\n                            tokens = token.slice(1);\n                            token = token[0];\n                        default:\n                            if (length) remove = 0;\n                            return token;\n                        }\n                    }\n                } else break;\n            }\n\n            var input = this.input;\n\n            if (index < input.length) {\n                if (this.reject) {\n                    remove = 0;\n                    var token = defunct.call(this, input.charAt(this.index++));\n                    if (typeof token !== \"undefined\") {\n                        if (Object.prototype.toString.call(token) === \"[object Array]\") {\n                            tokens = token.slice(1);\n                            return token[0];\n                        } else return token;\n                    }\n                } else {\n                    if (this.index !== index) remove = 0;\n                    this.reject = true;\n                }\n            } else if (matches.length)\n                this.reject = true;\n            else break;\n        }\n    };\n\n    function scan() {\n        var matches = [];\n        var index = 0;\n\n        var state = this.state;\n        var lastIndex = this.index;\n        var input = this.input;\n\n        for (var i = 0, length = rules.length; i < length; i++) {\n            var rule = rules[i];\n            var start = rule.start;\n            var states = start.length;\n\n            if ((!states || start.indexOf(state) >= 0) ||\n                (state % 2 && states === 1 && !start[0])) {\n                var pattern = rule.pattern;\n                pattern.lastIndex = lastIndex;\n                var result = pattern.exec(input);\n\n                if (result && result.index === lastIndex) {\n                    var j = matches.push({\n                        result: result,\n                        action: rule.action,\n                        length: result[0].length\n                    });\n\n                    if (rule.global) index = j;\n\n                    while (--j > index) {\n                        var k = j - 1;\n\n                        if (matches[j].length > matches[k].length) {\n                            var temple = matches[j];\n                            matches[j] = matches[k];\n                            matches[k] = temple;\n                        }\n                    }\n                }\n            }\n        }\n\n        return matches;\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","/**\n * https://github.com/rsms/js-lru/blob/v2/lru.js\n *\n * A doubly linked list-based Least Recently Used (LRU) cache. Will keep most\n * recently used items while discarding least recently used items when its limit\n * is reached.\n *\n * Licensed under MIT. Copyright (c) 2010 Rasmus Andersson <http://hunch.se/>\n * See README.md for details.\n *\n * Illustration of the design:\n *\n *       entry             entry             entry             entry\n *       ______            ______            ______            ______\n *      | head |.newer => |      |.newer => |      |.newer => | tail |\n *      |  A   |          |  B   |          |  C   |          |  D   |\n *      |______| <= older.|______| <= older.|______| <= older.|______|\n *\n *  removed  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  added\n */\nfunction LRUCache (limit) {\n  // Current size of the cache. (Read-only).\n  this.size = 0;\n  // Maximum number of items this cache can hold.\n  this.limit = limit;\n  this.oldest = this.newest = undefined;\n  this._keymap = {};\n}\n\n\nLRUCache.prototype._markEntryAsUsed = function(entry) {\n  if (entry === this.newest) {\n    // Already the most recenlty used entry, so no need to update the list\n    return;\n  }\n  // HEAD--------------TAIL\n  //   <.older   .newer>\n  //  <--- add direction --\n  //   A  B  C  <D>  E\n  if (entry.newer) {\n    if (entry === this.oldest) {\n      this.oldest = entry.newer;\n    }\n    entry.newer.older = entry.older; // C <-- E.\n  }\n  if (entry.older) {\n    entry.older.newer = entry.newer; // C. --> E\n  }\n  entry.newer = undefined; // D --x\n  entry.older = this.newest; // D. --> E\n  if (this.newest) {\n    this.newest.newer = entry; // E. <-- D\n  }\n  this.newest = entry;\n};\n\n/**\n * Put <value> into the cache associated with <key>. Returns the entry which was\n * removed to make room for the new entry. Otherwise undefined is returned\n * (i.e. if there was enough room already).\n */\nLRUCache.prototype.put = function(key, value) {\n  var entry = this._keymap[key];\n\n  if (entry) {\n    // update existing\n    entry.value = value;\n    this._markEntryAsUsed(entry);\n    return;\n  }\n\n  // new entry\n  this._keymap[key] = entry = {key:key, value:value, older:undefined, newer:undefined};\n\n  if (this.newest) {\n    // link previous tail to the new tail (entry)\n    this.newest.newer = entry;\n    entry.older = this.newest;\n  } else {\n    // we're first in -- yay\n    this.oldest = entry;\n  }\n\n  // add new entry to the end of the linked list -- it's now the freshest entry.\n  this.newest = entry;\n  this.size++;\n  if (this.size > this.limit) {\n    // we hit the limit -- remove the head\n    return this.shift();\n  }\n};\n\n/**\n * Purge the least recently used (oldest) entry from the cache. Returns the\n * removed entry or undefined if the cache was empty.\n *\n * If you need to perform any form of finalization of purged items, this is a\n * good place to do it. Simply override/replace this function:\n *\n *   var c = new LRUCache(123);\n *   c.shift = function() {\n *     var entry = LRUCache.prototype.shift.call(this);\n *     doSomethingWith(entry);\n *     return entry;\n *   }\n */\nLRUCache.prototype.shift = function() {\n  // todo: handle special case when limit == 1\n  var entry = this.oldest;\n  if (entry) {\n    if (this.oldest.newer) {\n      // advance the list\n      this.oldest = this.oldest.newer;\n      this.oldest.older = undefined;\n    } else {\n      // the cache is exhausted\n      this.oldest = undefined;\n      this.newest = undefined;\n    }\n    // Remove last strong reference to <entry> and remove links from the purged\n    // entry being returned:\n    entry.newer = entry.older = undefined;\n    // delete is slow, but we need to do this to avoid uncontrollable growth:\n    delete this._keymap[entry.key];\n    this.size--;\n  }\n  return entry;\n};\n\n/**\n * Get and register recent use of <key>. Returns the value associated with <key>\n * or undefined if not in cache.\n */\nLRUCache.prototype.get = function(key, returnEntry) {\n  // First, find our cache entry\n  var entry = this._keymap[key];\n  if (entry === undefined) return; // Not cached. Sorry.\n  // As <key> was found in the cache, register it as being requested recently\n  this._markEntryAsUsed(entry);\n  return returnEntry ? entry : entry.value;\n};\n\n// ----------------------------------------------------------------------------\n// Following code is optional and can be removed without breaking the core\n// functionality.\n\n/**\n * Check if <key> is in the cache without registering recent use. Feasible if\n * you do not want to chage the state of the cache, but only \"peek\" at it.\n * Returns the entry associated with <key> if found, or undefined if not found.\n */\nLRUCache.prototype.find = function(key) {\n  return this._keymap[key];\n};\n\n/**\n * Update the value of entry with <key>. Returns the old value, or undefined if\n * entry was not in the cache.\n */\nLRUCache.prototype.set = function(key, value) {\n  var oldvalue, entry = this.get(key, true);\n  if (entry) {\n    oldvalue = entry.value;\n    entry.value = value;\n  } else {\n    oldvalue = this.put(key, value);\n    if (oldvalue) oldvalue = oldvalue.value;\n  }\n  return oldvalue;\n};\n\n/**\n * Remove entry <key> from cache and return its value. Returns undefined if not\n * found.\n */\nLRUCache.prototype.remove = function(key) {\n  var entry = this._keymap[key];\n  if (!entry) return;\n  delete this._keymap[entry.key]; // need to do delete unfortunately\n  if (entry.newer && entry.older) {\n    // relink the older entry with the newer entry\n    entry.older.newer = entry.newer;\n    entry.newer.older = entry.older;\n  } else if (entry.newer) {\n    // remove the link to us\n    entry.newer.older = undefined;\n    // link the newer entry to head\n    this.oldest = entry.newer;\n  } else if (entry.older) {\n    // remove the link to us\n    entry.older.newer = undefined;\n    // link the newer entry to head\n    this.newest = entry.older;\n  } else {// if(entry.older === undefined && entry.newer === undefined) {\n    this.oldest = this.newest = undefined;\n  }\n\n  this.size--;\n  return entry.value;\n};\n\n/** Removes all entries */\nLRUCache.prototype.removeAll = function() {\n  // This should be safe, as we never expose strong refrences to the outside\n  this.oldest = this.newest = undefined;\n  this.size = 0;\n  this._keymap = {};\n};\n\n/**\n * Return an array containing all keys of entries stored in the cache object, in\n * arbitrary order.\n */\nif (typeof Object.keys === 'function') {\n  LRUCache.prototype.keys = function() {\n    return Object.keys(this._keymap);\n  };\n} else {\n  LRUCache.prototype.keys = function() {\n    var keys = [];\n    for (var k in this._keymap) {\n      keys.push(k);\n    }\n    return keys;\n  };\n}\n\n/**\n * Call `fun` for each entry. Starting with the newest entry if `desc` is a true\n * value, otherwise starts with the oldest (head) enrty and moves towards the\n * tail.\n *\n * `fun` is called with 3 arguments in the context `context`:\n *   `fun.call(context, Object key, Object value, LRUCache self)`\n */\nLRUCache.prototype.forEach = function(fun, context, desc) {\n  var entry;\n  if (context === true) {\n    desc = true;\n    context = undefined;\n  } else if (typeof context !== 'object') {\n    context = this;\n  }\n  if (desc) {\n    entry = this.newest;\n    while (entry) {\n      fun.call(context, entry.key, entry.value, this);\n      entry = entry.older;\n    }\n  } else {\n    entry = this.oldest;\n    while (entry) {\n      fun.call(context, entry.key, entry.value, this);\n      entry = entry.newer;\n    }\n  }\n};\n\n/** Returns a JSON (array) representation */\nLRUCache.prototype.toJSON = function() {\n  var s = new Array(this.size), i = 0, entry = this.oldest;\n  while (entry) {\n    s[i++] = { key: entry.key, value: entry.value };\n    entry = entry.newer;\n  }\n  return s;\n};\n\n/** Returns a String representation */\nLRUCache.prototype.toString = function() {\n  var s = '', entry = this.oldest;\n  while (entry) {\n    s += String(entry.key)+':'+entry.value;\n    entry = entry.newer;\n    if (entry) {\n      s += ' < ';\n    }\n  }\n  return s;\n};\n\n// Export ourselves\nexport default LRUCache;\n","import Lexer from 'lex';\nimport LRUCache from './lru-cache';\n\nvar reIntValue = '(-?0|-?[1-9][0-9]*)';\nvar reFractionPart = '\\\\.[0-9]+';\nvar reExponentPart = '[eE][+-]?[0-9]+';\nvar intRegex = new RegExp(reIntValue);\nvar floatRegex = new RegExp(\n    reIntValue + reFractionPart + reExponentPart + '|' +\n    reIntValue + reFractionPart + '|' +\n    reIntValue + reExponentPart);\nvar reLineTerminators = '\\\\n\\\\r\\\\u2028\\\\u2029';\nvar reEscapedChar = '\\\\\\\\[\\\\\\\\\"/bfnrt]';\nvar reEscapedUnicode = '\\\\\\\\u[0-9A-Fa-f]{4}';\nvar reStringChar = '[^\\\\\"\\\\\\\\' + reLineTerminators + ']';\nvar stringRegex = new RegExp(\n    '\\\\\"(' + reEscapedChar +\n    '|' + reEscapedUnicode +\n    '|' + reStringChar + ')*\\\\\"');\nvar nameRegex = /[_A-Za-z][_0-9A-Za-z]*(\\.[_A-Za-z][_0-9A-Za-z]*)*/;\nvar reNotFollowedByName = '(?![_0-9A-Za-z])';\nvar whitespaceRegex = /[ \\t\\v\\f\\u00A0]+/;\n\nvar lexer = new Lexer(function () {\n  // Silently swallow any lexer errors\n});\n\nfunction token(name, value) {\n  return { name: name, value: value };\n}\n\nlexer.addRule(whitespaceRegex, function () { /* ignore whitespace */ });\nlexer.addRule(/\\./, function (l) { return token('DOT', l); });\nlexer.addRule(/,/, function (l) { return token('COMMA', l); });\nlexer.addRule(new RegExp('or' + reNotFollowedByName), function (l) {\n  return token('OR', l);\n});\nlexer.addRule(new RegExp('and' + reNotFollowedByName), function (l) {\n  return token('AND', l);\n});\nlexer.addRule(new RegExp('not' + reNotFollowedByName), function (l) {\n  return token('NOT', l);\n});\nlexer.addRule(new RegExp('in' + reNotFollowedByName), function (l) {\n  return token('IN', l);\n});\nlexer.addRule(new RegExp('True' + reNotFollowedByName), function (l) {\n  return token('TRUE', l);\n});\nlexer.addRule(new RegExp('False' + reNotFollowedByName), function (l) {\n  return token('FALSE', l);\n});\nlexer.addRule(new RegExp('None' + reNotFollowedByName), function (l) {\n  return token('NONE', l);\n});\nlexer.addRule(nameRegex, function (l) { return token('NAME', l); });\nlexer.addRule(stringRegex, function (l) {\n  // Trim leading and trailing quotes\n  return token('STRING_VALUE', l.slice(1, l.length - 1));\n});\nlexer.addRule(intRegex, function (l) { return token('INT_VALUE', l); });\nlexer.addRule(floatRegex, function (l) { return token('FLOAT_VALUE', l); });\nlexer.addRule(/\\(/, function (l) { return token('PAREN_L', l); });\nlexer.addRule(/\\)/, function (l) { return token('PAREN_R', l); });\nlexer.addRule(/=/, function (l) { return token('EQUALS', l); });\nlexer.addRule(/!=/, function (l) { return token('NOT_EQUALS', l); });\nlexer.addRule(/>/, function (l) { return token('GREATER', l); });\nlexer.addRule(/>=/, function (l) { return token('GREATER_EQUAL', l); });\nlexer.addRule(/</, function (l) { return token('LESS', l); });\nlexer.addRule(/<=/, function (l) { return token('LESS_EQUAL', l); });\nlexer.addRule(/~/, function (l) { return token('CONTAINS', l); });\nlexer.addRule(/!~/, function (l) { return token('NOT_CONTAINS', l); });\nlexer.lexAll = function () {\n  var match;\n  var result = [];\n  while (match = this.lex()) {  // eslint-disable-line no-cond-assign\n    match.start = this.index - match.value.length;\n    match.end = this.index;\n    result.push(match);\n  }\n  return result;\n};\n\nfunction suggestion(text, snippetBefore, snippetAfter) {\n  // text is being displayed in completion box and pasted when you hit Enter.\n  // snippetBefore is an optional extra text to be pasted before main text.\n  // snippetAfter is an optional text to be pasted after. It may also include\n  // \"|\" symbol to designate desired cursor position after paste.\n  return {\n    text: text,\n    snippetBefore: snippetBefore || '',\n    snippetAfter: snippetAfter || ''\n  };\n}\n\n// Main DjangoQL object\nvar DjangoQL = function (options) {\n  var cacheSize = 100;\n\n  this.options = options;\n  this.currentModel = null;\n  this.models = {};\n  this.suggestionsAPIUrl = null;\n\n  this.token = token;\n  this.lexer = lexer;\n\n  this.prefix = '';\n  this.suggestions = [];\n  this.selected = null;\n  this.valuesCaseSensitive = false;\n  this.highlightCaseSensitive = true;\n\n  this.textarea = null;\n  this.completion = null;\n  this.completionUL = null;\n  this.completionEnabled = false;\n\n  // Initialization\n  if (!this.isObject(options)) {\n    this.logError('Please pass an object with initialization parameters');\n    return;\n  }\n  this.loadIntrospections(options.introspections);\n  if (typeof options.selector === 'string') {\n    this.textarea = document.querySelector(options.selector);\n  } else {\n    this.textarea = options.selector;\n  }\n  if (!this.textarea) {\n    this.logError('Element not found by selector: ' + options.selector);\n    return;\n  }\n  if (this.textarea.tagName !== 'TEXTAREA') {\n    this.logError('selector must be pointing to <textarea> element, but ' +\n        this.textarea.tagName + ' was found');\n    return;\n  }\n  if (options.valuesCaseSensitive) {\n    this.valuesCaseSensitive = true;\n  }\n  if (options.cacheSize) {\n    if (parseInt(options.cacheSize, 10) !== options.cacheSize\n        || options.cacheSize < 1) {\n      this.logError('cacheSize must be a positive integer');\n    } else {\n      cacheSize = options.cacheSize;\n    }\n  }\n  this.suggestionsCache = new LRUCache(cacheSize);\n  this.debouncedLoadFieldOptions = this.debounce(\n    this.loadFieldOptions.bind(this),\n    300);\n  this.loading = false;\n\n  this.enableCompletion = this.enableCompletion.bind(this);\n  this.disableCompletion = this.disableCompletion.bind(this);\n\n  // these handlers are re-used more than once in the code below,\n  // so it's handy to have them already bound\n  this.onCompletionMouseClick = this.onCompletionMouseClick.bind(this);\n  this.onCompletionMouseDown = this.onCompletionMouseDown.bind(this);\n  this.popupCompletion = this.popupCompletion.bind(this);\n  this.debouncedRenderCompletion = this.debounce(\n      this.renderCompletion.bind(this),\n      50);\n\n  // Bind event handlers and initialize completion & textSize containers\n  this.textarea.setAttribute('autocomplete', 'off');\n  this.textarea.addEventListener('keydown', this.onKeydown.bind(this));\n  this.textarea.addEventListener('blur', this.hideCompletion.bind(this));\n  this.textarea.addEventListener('click', this.popupCompletion);\n  if (options.autoResize) {\n    this.textareaResize = this.textareaResize.bind(this);\n    this.textarea.style.resize = 'none';\n    this.textarea.style.overflow = 'hidden';\n    this.textarea.addEventListener('input', this.textareaResize);\n    this.textareaResize();\n    // There could be a situation when fonts are not loaded yet at this\n    // point. When fonts are finally loaded it could make textarea looking\n    // weird - for example in Django 1.9+ last line won't fit. To fix this\n    // we call .textareaResize() once again when window is fully loaded.\n    window.addEventListener('load', this.textareaResize);\n  } else {\n    this.textareaResize = null;\n    // Catch resize events and re-position completion box.\n    // See http://stackoverflow.com/a/7055239\n    this.textarea.addEventListener(\n        'mouseup', this.renderCompletion.bind(this, true));\n    this.textarea.addEventListener(\n        'mouseout', this.renderCompletion.bind(this, true));\n  }\n\n  this.createCompletionElement();\n};\n\n// Backward compatibility\nDjangoQL.init = function (options) {\n  return new DjangoQL(options);\n};\n\nDjangoQL.DOMReady = function (callback) {\n  if (document.readyState !== 'loading') {\n    callback();\n  } else {\n    document.addEventListener('DOMContentLoaded', callback);\n  }\n};\n\nDjangoQL.prototype = {\n  createCompletionElement: function () {\n    var options = this.options;\n    var syntaxHelp;\n\n    if (!this.completion) {\n      this.completion = document.createElement('div');\n      this.completion.className = 'djangoql-completion';\n      document.querySelector('body').appendChild(this.completion);\n      this.completionUL = document.createElement('ul');\n      this.completionUL.onscroll = this.throttle(\n        this.onCompletionScroll.bind(this),\n        50);\n      this.completion.appendChild(this.completionUL);\n      if (typeof options.syntaxHelp === 'string') {\n        syntaxHelp = document.createElement('p');\n        syntaxHelp.className = 'syntax-help';\n        syntaxHelp.innerHTML = '<a href=\"' + options.syntaxHelp +\n            '\" target=\"_blank\">Syntax Help</a>';\n        syntaxHelp.addEventListener('mousedown', function (e) {\n          // This is needed to prevent conflict with textarea.onblur event\n          // handler, which tries to hide the completion box and therefore\n          // makes Syntax Help link malfunctional.\n          e.preventDefault();\n        });\n        this.completion.appendChild(syntaxHelp);\n      }\n\n      this.completionEnabled = options.hasOwnProperty('completionEnabled') ?\n        options.completionEnabled :\n        true;\n    }\n  },\n\n  destroyCompletionElement: function () {\n    if (this.completion) {\n      this.completion.parentNode.removeChild(this.completion);\n      this.completion = null;\n      this.completionEnabled = false;\n    }\n  },\n\n  enableCompletion: function () {\n    this.completionEnabled = true;\n  },\n\n  disableCompletion: function () {\n    this.completionEnabled = false;\n    this.hideCompletion();\n  },\n\n  getJson: function (url, settings) {\n    this.loading = true;\n\n    var onLoadError = function () {\n      this.loading = false;\n      this.request = null;\n      this.logError('failed to fetch from ' + url);\n    }.bind(this);\n\n    if (this.request) {\n      this.request.abort();\n    }\n    this.request = new XMLHttpRequest();\n\n    this.request.open('GET', url, true);\n    this.request.onload = function () {\n      this.loading = false;\n      if (this.request.status === 200) {\n        if (typeof settings.success === 'function') {\n          settings.success(JSON.parse(this.request.responseText));\n        }\n      } else {\n        onLoadError();\n      }\n      this.request = null;\n    }.bind(this);\n    this.request.ontimeout = onLoadError;\n    this.request.onerror = onLoadError;\n    /* eslint-disable max-len */\n    // Workaround for IE9, see\n    // https://cypressnorth.com/programming/internet-explorer-aborting-ajax-requests-fixed/\n    /* eslint-enable max-len */\n    this.request.onprogress = function () {};\n    window.setTimeout(this.request.send.bind(this.request));\n  },\n\n  loadIntrospections: function (introspections) {\n    var initIntrospections = function (data) {\n      this.currentModel = data.current_model;\n      this.models = data.models;\n      this.suggestionsAPIUrl = data.suggestions_api_url;\n    }.bind(this);\n\n    if (typeof introspections === 'string') {\n      // treat as URL\n      this.getJson(introspections, { success: initIntrospections });\n    } else if (this.isObject(introspections)) {\n      initIntrospections(introspections);\n    } else {\n      this.logError(\n          'introspections parameter is expected to be either URL or ' +\n          'object with definitions, but ' + introspections + ' was found');\n    }\n  },\n\n  isObject: function (obj) {\n    return (({}).toString.call(obj) === '[object Object]');\n  },\n\n  debounce: function (func, wait, immediate) {\n    // Borrowed from Underscore.js\n    var args;\n    var context;\n    var result;\n    var timeout;\n    var timestamp;\n\n    var later = function () {\n      var last = Date.now() - timestamp;\n      if (last < wait && last >= 0) {\n        timeout = setTimeout(later, wait - last);\n      } else {\n        timeout = null;\n        if (!immediate) {\n          result = func.apply(context, args);\n          if (!timeout) {\n            args = null;\n            context = null;\n          }\n        }\n      }\n    };\n\n    return function () {\n      var callNow;\n      context = this;\n      args = arguments;\n      timestamp = Date.now();\n      callNow = immediate && !timeout;\n      if (!timeout) timeout = setTimeout(later, wait);\n      if (callNow) {\n        result = func.apply(context, args);\n        args = null;\n        context = null;\n      }\n      return result;\n    };\n  },\n\n  throttle: function (func, wait, options) {\n    // Borrowed from Underscore.js\n    var timeout;\n    var context;\n    var args;\n    var result;\n    var previous = 0;\n    var later;\n    var throttled;\n\n    if (!options) {\n      options = {};\n    }\n\n    later = function () {\n      previous = options.leading === false ? 0 : new Date().getTime();\n      timeout = null;\n      result = func.apply(context, args);\n      if (!timeout) {\n        context = null;\n        args = null;\n      }\n    };\n\n    throttled = function () {\n      var now = new Date().getTime();\n      var remaining;\n\n      if (!previous && options.leading === false) {\n        previous = now;\n      }\n      remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          window.clearTimeout(timeout);\n          timeout = null;\n        }\n        previous = now;\n        result = func.apply(context, args);\n        if (!timeout) {\n          context = null;\n          args = null;\n        }\n      } else if (!timeout && options.trailing !== false) {\n        timeout = window.setTimeout(later, remaining);\n      }\n      return result;\n    };\n\n    throttled.cancel = function () {\n      window.clearTimeout(timeout);\n      previous = 0;\n      timeout = null;\n      context = null;\n      args = null;\n    };\n\n    return throttled;\n  },\n\n  setUrlParams: function (url, params) {\n    var parts = url.split('?');\n    var path = parts[0];\n    var queryString = parts.slice(1).join('?');\n    var pairs = queryString.split('&');\n    var pair;\n    var key;\n    var value;\n    var i;\n\n    for (key in params) {\n      if (params.hasOwnProperty(key)) {\n        key = encodeURI(key);\n        value = encodeURI(params[key]);\n        i = pairs.length;\n        while (i--) {\n          pair = pairs[i].split('=');\n          if (pair[0] === key) {\n            pair[1] = value;\n            pairs[i] = pair.join('=');\n            break;\n          }\n        }\n        if (i < 0) {\n          pairs.push(key + '=' + value);\n        }\n      }\n    }\n    queryString = pairs.join('&');\n    return queryString ? [path, queryString].join('?') : path;\n  },\n\n  logError: function (message) {\n    console.error('DjangoQL: ' + message);  // eslint-disable-line no-console\n  },\n\n  onCompletionMouseClick: function (e) {\n    this.selectCompletion(\n      parseInt(e.currentTarget.getAttribute('data-index'), 10)\n    );\n  },\n\n  onCompletionMouseDown: function (e) {\n    // This is needed to prevent 'blur' event on textarea\n    e.preventDefault();\n  },\n\n  onKeydown: function (e) {\n    switch (e.keyCode) {\n      case 38:  // up arrow\n        if (this.suggestions.length) {\n          if (this.selected === null) {\n            this.selected = this.suggestions.length - 1;\n          } else if (this.selected === 0) {\n            this.selected = null;\n          } else {\n            this.selected -= 1;\n          }\n          this.renderCompletion();\n          e.preventDefault();\n        }\n        break;\n\n      case 40:  // down arrow\n        if (this.suggestions.length) {\n          if (this.selected === null) {\n            this.selected = 0;\n          } else if (this.selected < this.suggestions.length - 1) {\n            this.selected += 1;\n          } else {\n            this.selected = null;\n          }\n          this.renderCompletion();\n          e.preventDefault();\n        }\n        break;\n\n      case 9:   // Tab\n        if (this.selected !== null) {\n          this.selectCompletion(this.selected);\n          e.preventDefault();\n        }\n        break;\n\n      case 13:  // Enter\n        if (this.selected !== null) {\n          this.selectCompletion(this.selected);\n        } else {\n          // Technically this is a textarea, due to automatic multi-line\n          // feature, but other than that it should look and behave like\n          // a normal input. So expected behavior when pressing Enter is\n          // to submit the form, not to add a new line.\n          if (typeof this.options.onSubmit === 'function') {\n            this.options.onSubmit(this.textarea.value);\n          } else {\n            e.currentTarget.form.submit();\n          }\n        }\n        e.preventDefault();\n        break;\n\n      case 27:  // Esc\n        this.hideCompletion();\n        break;\n\n      case 16:  // Shift\n      case 17:  // Ctrl\n      case 18:  // Alt\n      case 91:  // Windows Key or Left Cmd on Mac\n      case 93:  // Windows Menu or Right Cmd on Mac\n        // Control keys shouldn't trigger completion popup\n        break;\n\n      default:\n        // When keydown is fired input value has not been updated yet,\n        // so we need to wait\n        window.setTimeout(this.popupCompletion, 10);\n        break;\n    }\n  },\n\n  textareaResize: function () {\n    // Automatically grow/shrink textarea to have the contents always visible\n    var style = window.getComputedStyle(this.textarea, null);\n    var heightOffset = parseFloat(style.paddingTop) +\n        parseFloat(style.paddingBottom);\n    this.textarea.style.height = '5px';\n    // dirty hack, works for Django admin styles only.\n    // Ping me if you know how to get rid of \"+1\"\n    this.textarea.style.height = (this.textarea.scrollHeight - heightOffset) +\n        1 + 'px';\n  },\n\n  popupCompletion: function () {\n    this.generateSuggestions();\n    this.renderCompletion();\n  },\n\n  selectCompletion: function (index) {\n    var context = this.getContext(\n      this.textarea.value,\n      this.textarea.selectionStart\n    );\n    var currentFullToken = context.currentFullToken;\n    var textValue = this.textarea.value;\n    var startPos = this.textarea.selectionStart - context.prefix.length;\n    var tokenEndPos = null;\n\n    // cutting current token from the string\n    if (currentFullToken) {\n      tokenEndPos = currentFullToken.end;\n      textValue = (\n        textValue.slice(0, startPos) + textValue.slice(tokenEndPos)\n      );\n    }\n\n    var textBefore = textValue.slice(0, startPos);\n    var textAfter = textValue.slice(startPos);\n    // preventing double spaces after pasting the suggestion\n    textAfter = textAfter.trim();\n\n    var completion = this.suggestions[index];\n    var snippetBefore = completion.snippetBefore;\n    var snippetAfter = completion.snippetAfter;\n    var snippetAfterParts = snippetAfter.split('|');\n    if (snippetAfterParts.length > 1) {\n      snippetAfter = snippetAfterParts.join('');\n      if (!snippetBefore && !completion.text) {\n        snippetBefore = snippetAfterParts[0];\n        snippetAfter = snippetAfterParts[1];\n      }\n    }\n    if (textBefore.endsWith(snippetBefore)) {\n      snippetBefore = '';\n    }\n    if (textAfter.startsWith(snippetAfter)) {\n      snippetAfter = '';\n    }\n    var textToPaste = snippetBefore + completion.text + snippetAfter;\n    var cursorPosAfter = textBefore.length + textToPaste.length;\n    if (snippetAfterParts.length > 1) {\n      cursorPosAfter -= snippetAfterParts[1].length;\n    }\n\n    this.textarea.value = textBefore + textToPaste + textAfter;\n    this.textarea.focus();\n    this.textarea.setSelectionRange(cursorPosAfter, cursorPosAfter);\n    this.selected = null;\n    if (this.textareaResize) {\n      this.textareaResize();\n    }\n    this.generateSuggestions(this.textarea);\n    this.renderCompletion();\n  },\n\n  hideCompletion: function () {\n    this.selected = null;\n    if (this.completion) {\n      this.completion.style.display = 'none';\n    }\n  },\n\n  escapeRegExp: function (str) {\n    // http://stackoverflow.com\n    // /questions/3446170/escape-string-for-use-in-javascript-regex\n    return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');  // eslint-disable-line\n  },\n\n  highlight: function (text, highlight) {\n    if (!highlight || !text) {\n      return text;\n    } else if (this.highlightCaseSensitive) {\n      return text.split(highlight).join('<b>' + highlight + '</b>');\n    }\n    return text.replace(\n        new RegExp('(' + this.escapeRegExp(highlight) + ')', 'ig'),\n        '<b>$1</b>');\n  },\n\n  renderCompletion: function (dontForceDisplay) {\n    var currentLi;\n    var i;\n    var completionRect;\n    var currentLiRect;\n    var inputRect;\n    var li;\n    var liLen;\n    var suggestionsLen;\n    var loadingElement;\n\n    if (!this.completionEnabled) {\n      this.hideCompletion();\n      return;\n    }\n\n    if (dontForceDisplay && this.completion.style.display === 'none') {\n      return;\n    }\n    if (!this.suggestions.length && !this.loading) {\n      this.hideCompletion();\n      return;\n    }\n\n    suggestionsLen = this.suggestions.length;\n    li = [].slice.call(this.completionUL.querySelectorAll('li[data-index]'));\n    liLen = li.length;\n\n    // Update or create necessary elements\n    for (i = 0; i < suggestionsLen; i++) {\n      if (i < liLen) {\n        currentLi = li[i];\n      } else {\n        currentLi = document.createElement('li');\n        currentLi.setAttribute('data-index', i);\n        currentLi.addEventListener('click', this.onCompletionMouseClick);\n        currentLi.addEventListener('mousedown', this.onCompletionMouseDown);\n        this.completionUL.appendChild(currentLi);\n      }\n      currentLi.innerHTML = this.highlight(\n          this.suggestions[i].text,\n          this.prefix);\n      if (i === this.selected) {\n        currentLi.className = 'active';\n        currentLiRect = currentLi.getBoundingClientRect();\n        completionRect = this.completionUL.getBoundingClientRect();\n        if (currentLiRect.bottom > completionRect.bottom) {\n          this.completionUL.scrollTop = this.completionUL.scrollTop + 2 +\n              (currentLiRect.bottom - completionRect.bottom);\n        } else if (currentLiRect.top < completionRect.top) {\n          this.completionUL.scrollTop = this.completionUL.scrollTop - 2 -\n              (completionRect.top - currentLiRect.top);\n        }\n      } else {\n        currentLi.className = '';\n      }\n    }\n    // Remove redundant elements\n    while (liLen > suggestionsLen) {\n      liLen--;\n      li[liLen].removeEventListener('click', this.onCompletionMouseClick);\n      li[liLen].removeEventListener('mousedown', this.onCompletionMouseDown);\n      this.completionUL.removeChild(li[liLen]);\n    }\n\n    loadingElement = this.completionUL.querySelector('li.djangoql-loading');\n\n    if (this.loading) {\n      if (!loadingElement) {\n        loadingElement = document.createElement('li');\n        loadingElement.className = 'djangoql-loading';\n        loadingElement.innerHTML = '&nbsp;';\n        this.completionUL.appendChild(loadingElement);\n      }\n    } else if (loadingElement) {\n      this.completionUL.removeChild(loadingElement);\n    }\n\n    inputRect = this.textarea.getBoundingClientRect();\n    this.completion.style.top = window.pageYOffset + inputRect.top +\n        inputRect.height + 'px';\n    this.completion.style.left = inputRect.left + 'px';\n    this.completion.style.display = 'block';\n  },\n\n  resolveName: function (name) {\n    // Walk through introspection definitions and get target model and field\n    var f;\n    var i;\n    var l;\n    var nameParts = name.split('.');\n    var model = this.currentModel;\n    var field = null;\n\n    if (model) {\n      for (i = 0, l = nameParts.length; i < l; i++) {\n        f = this.models[model][nameParts[i]];\n        if (!f) {\n          model = null;\n          field = null;\n          break;\n        } else if (f.type === 'relation') {\n          model = f.relation;\n          field = null;\n        } else {\n          field = nameParts[i];\n        }\n      }\n    }\n    return { model: model, field: field };\n  },\n\n  getContext: function (text, cursorPos) {\n    // This function returns an object with the following 4 properties:\n    var prefix;        // text already entered by user in the current scope\n    var scope = null;  // 'field', 'comparison', 'value', 'logical' or null\n    var model = null;  // model, set for 'field', 'comparison' and 'value'\n    var field = null;  // field, set for 'comparison' and 'value'\n\n    var whitespace;\n    var nameParts;\n    var resolvedName;\n    var lastToken = null;\n    var nextToLastToken = null;\n    var tokens = this.lexer.setInput(text.slice(0, cursorPos)).lexAll();\n    var allTokens = this.lexer.setInput(text).lexAll();\n    var currentFullToken = null;\n    if (tokens.length && tokens[tokens.length - 1].end >= cursorPos) {\n      // if cursor is positioned on the last token then remove it.\n      // We are only interested in tokens preceding current.\n      currentFullToken = allTokens[tokens.length - 1];\n      tokens.pop();\n    }\n    if (tokens.length) {\n      lastToken = tokens[tokens.length - 1];\n      if (tokens.length > 1) {\n        nextToLastToken = tokens[tokens.length - 2];\n      }\n    }\n\n    // Current token which is currently being typed may be not complete yet,\n    // so lexer may fail to recognize it correctly. So we define current token\n    // prefix as a string without whitespace positioned after previous token\n    // and until current cursor position.\n    prefix = text.slice(lastToken ? lastToken.end : 0, cursorPos);\n    whitespace = prefix.match(whitespaceRegex);\n    if (whitespace) {\n      prefix = prefix.slice(whitespace[0].length);\n    }\n    if (prefix === '(') {\n      // Paren should not be a part of suggestion\n      prefix = '';\n    }\n\n    if (prefix === ')' && !whitespace) {\n      // Nothing to suggest right after right paren\n    } else if (!lastToken ||\n        (['AND', 'OR'].indexOf(lastToken.name) >= 0 && whitespace) ||\n        (prefix === '.' && lastToken && !whitespace) ||\n        (lastToken.name === 'PAREN_L' && (!nextToLastToken ||\n            ['AND', 'OR'].indexOf(nextToLastToken.name) >= 0))) {\n      scope = 'field';\n      model = this.currentModel;\n      if (prefix === '.') {\n        prefix = text.slice(lastToken.start, cursorPos);\n      }\n      nameParts = prefix.split('.');\n      if (nameParts.length > 1) {\n        // use last part as a prefix, analyze preceding parts to get the model\n        prefix = nameParts.pop();\n        resolvedName = this.resolveName(nameParts.join('.'));\n        if (resolvedName.model && !resolvedName.field) {\n          model = resolvedName.model;\n        } else {\n          // if resolvedName.model is null that means that model wasn't found.\n          // if resolvedName.field is NOT null that means that the name\n          // preceding current prefix is a concrete field and not a relation,\n          // and therefore it can't have any properties.\n          scope = null;\n          model = null;\n        }\n      }\n    } else if (lastToken && whitespace &&\n        nextToLastToken && nextToLastToken.name === 'NAME' &&\n        ['EQUALS', 'NOT_EQUALS', 'CONTAINS', 'NOT_CONTAINS', 'GREATER_EQUAL',\n          'GREATER', 'LESS_EQUAL', 'LESS'].indexOf(lastToken.name) >= 0) {\n      resolvedName = this.resolveName(nextToLastToken.value);\n      if (resolvedName.model) {\n        scope = 'value';\n        model = resolvedName.model;\n        field = resolvedName.field;\n        if (prefix[0] === '\"' && (this.models[model][field].type === 'str'\n            || this.models[model][field].options)) {\n          prefix = prefix.slice(1);\n        }\n      }\n    } else if (lastToken && whitespace && lastToken.name === 'NAME') {\n      resolvedName = this.resolveName(lastToken.value);\n      if (resolvedName.model) {\n        scope = 'comparison';\n        model = resolvedName.model;\n        field = resolvedName.field;\n      }\n    } else if (lastToken && whitespace &&\n        ['PAREN_R', 'INT_VALUE', 'FLOAT_VALUE', 'STRING_VALUE']\n            .indexOf(lastToken.name) >= 0) {\n      scope = 'logical';\n    }\n    return {\n      prefix: prefix,\n      scope: scope,\n      model: model,\n      field: field,\n      currentFullToken: currentFullToken\n    };\n  },\n\n  getCurrentFieldOptions: function () {\n    var input = this.textarea;\n    var context = this.getContext(input.value, input.selectionStart);\n    var model = this.models[context.model];\n    var field = context.field && model[context.field];\n    var fieldOptions = {\n      cacheKey: null,\n      context: context,\n      field: field,\n      model: model,\n      options: null\n    };\n\n    if (context.scope !== 'value' || !field || !field.options) {\n      return null;\n    }\n    if (Array.isArray(field.options)) {\n      fieldOptions.options = field.options;\n    } else if (field.options === true) {\n      // Means get via API\n      if (!this.suggestionsAPIUrl) {\n        return null;\n      }\n      fieldOptions.cacheKey = context.model + '.' + context.field\n        + '|' + context.prefix;\n    }\n    return fieldOptions;\n  },\n\n  loadFieldOptions: function (loadMore) {\n    var fieldOptions = this.getCurrentFieldOptions() || {};\n    var context = fieldOptions.context;\n    var cached;\n    var requestUrl;\n    var requestParams;\n\n    if (!fieldOptions.cacheKey) {\n      // The context has likely changed, user's cursor is in another position\n      return;\n    }\n    requestParams = {\n      field: context.model + '.' + context.field,\n      search: context.prefix\n    };\n\n    cached = this.suggestionsCache.get(fieldOptions.cacheKey) || {};\n    if (loadMore && cached.has_next) {\n      requestParams.page = cached.page ? cached.page + 1 : 1;\n    } else if (cached.page) {\n      // At least the first page is already loaded\n      return;\n    }\n\n    cached.loading = true;\n    this.suggestionsCache.set(fieldOptions.cacheKey, cached);\n\n    requestUrl = this.setUrlParams(this.suggestionsAPIUrl, requestParams);\n    this.getJson(requestUrl, {\n      success: function (data) {\n        var cached = this.suggestionsCache.get(fieldOptions.cacheKey) || {};\n        if (data.page - 1 !== (cached.page || 0)) {\n          // either pages were loaded out of order,\n          // or cache is no longer exists\n          return;\n        }\n        data.items = (cached.items || []).concat(data.items);\n        this.suggestionsCache.set(fieldOptions.cacheKey, data);\n        this.loading = false;\n        this.populateFieldOptions();\n        this.renderCompletion();\n      }.bind(this)\n    });\n    // Render 'loading' element\n    this.populateFieldOptions();\n    this.renderCompletion();\n  },\n\n  populateFieldOptions: function (loadMore) {\n    var fieldOptions = this.getCurrentFieldOptions();\n    if (fieldOptions === null) {\n      // 1) we are out of field options context\n      // 2) field has no options\n      return;\n    }\n    var options = fieldOptions.options;\n    var prefix = fieldOptions.context && fieldOptions.context.prefix;\n    var cached;\n\n    if (options) {\n      // filter them locally\n      if (this.valuesCaseSensitive) {\n        options = options.filter(function (item) {\n          // Case-sensitive\n          return item.indexOf(prefix) >= 0;\n        });\n      } else {\n        options = options.filter(function (item) {\n          // Case-insensitive\n          return item.toLowerCase().indexOf(prefix.toLowerCase()) >= 0;\n        });\n      }\n    } else {\n      this.suggestions = [];\n      if (!fieldOptions.cacheKey) {\n        return;\n      }\n      cached = this.suggestionsCache.get(fieldOptions.cacheKey) || {};\n      options = cached.items || [];\n      if (!cached.loading\n          && (!cached.page || (loadMore && cached.has_next))) {\n        this.debouncedLoadFieldOptions(loadMore);\n      }\n      if (!options.length) {\n        // Should we show 'no results' message?\n        return;\n      }\n    }\n\n    this.highlightCaseSensitive = this.valuesCaseSensitive;\n    this.suggestions = options.map(function (f) {\n      return suggestion(f, '\"', '\"');\n    });\n  },\n\n  onCompletionScroll: function () {\n    var rectHeight = this.completionUL.getBoundingClientRect().height;\n    var scrollBottom = this.completionUL.scrollTop + rectHeight;\n    if (scrollBottom > rectHeight\n        && scrollBottom > (this.completionUL.scrollHeight - rectHeight)) {\n      // TODO: add some checks of context?\n      this.populateFieldOptions(true);\n    }\n  },\n\n  generateSuggestions: function () {\n    var input = this.textarea;\n    var context;\n    var model;\n    var field;\n    var suggestions;\n    var snippetAfter;\n    var searchFilter;\n\n    if (!this.completionEnabled) {\n      this.prefix = '';\n      this.suggestions = [];\n      return;\n    }\n\n    if (!this.currentModel) {\n      // Introspections are not loaded yet\n      return;\n    }\n    if (input.selectionStart !== input.selectionEnd) {\n      // We shouldn't show suggestions when something is selected\n      this.prefix = '';\n      this.suggestions = [];\n      return;\n    }\n\n    // default search filter - find anywhere in the string, case-sensitive\n    searchFilter = function (item) {\n      return item.text.indexOf(this.prefix) >= 0;\n    }.bind(this);\n    // default highlight mode - case sensitive\n    this.highlightCaseSensitive = true;\n\n    context = this.getContext(input.value, input.selectionStart);\n    this.prefix = context.prefix;\n    model = this.models[context.model];\n    field = context.field && model[context.field];\n\n    switch (context.scope) {\n      case 'field':\n        this.suggestions = Object.keys(model).map(function (f) {\n          return suggestion(f, '', model[f].type === 'relation' ? '.' : ' ');\n        });\n        break;\n\n      case 'comparison':\n        suggestions = ['=', '!='];\n        snippetAfter = ' ';\n        if (field && field.type !== 'bool') {\n          if (field.type === 'str') {\n            suggestions.push('~');\n            suggestions.push('!~');\n            snippetAfter = ' \"|\"';\n          } else if (field.type === 'date' || field.type === 'datetime'\n                     || field.options) {\n            snippetAfter = ' \"|\"';\n          }\n          Array.prototype.push.apply(suggestions, ['>', '>=', '<', '<=']);\n        }\n        this.suggestions = suggestions.map(function (s) {\n          return suggestion(s, '', snippetAfter);\n        });\n        if (field && field.type !== 'bool') {\n          if (['str', 'date', 'datetime'].indexOf(field.type) >= 0\n              || field.options) {\n            snippetAfter = ' (\"|\")';\n          } else {\n            snippetAfter = ' (|)';\n          }\n          this.suggestions.push(suggestion('in', '', snippetAfter));\n          this.suggestions.push(suggestion('not in', '', snippetAfter));\n        }\n        // use \"starts with\" search filter instead of default\n        searchFilter = function (item) {\n          // See http://stackoverflow.com/a/4579228\n          return item.text.lastIndexOf(this.prefix, 0) === 0;\n        }.bind(this);\n        break;\n\n      case 'value':\n        if (!field) {\n          // related field\n          this.suggestions = [suggestion('None', '', ' ')];\n        } else if (field.options) {\n          this.prefix = context.prefix;\n          this.populateFieldOptions();\n        } else if (field.type === 'bool') {\n          this.suggestions = [\n            suggestion('True', '', ' '),\n            suggestion('False', '', ' ')\n          ];\n          if (field.nullable) {\n            this.suggestions.push(suggestion('None', '', ' '));\n          }\n        } else if (field.type === 'unknown') {\n          // unknown field type, reset suggestions\n          this.prefix = '';\n          this.suggestions = [];\n        }\n        break;\n\n      case 'logical':\n        this.suggestions = [\n          suggestion('and', '', ' '),\n          suggestion('or', '', ' ')\n        ];\n        break;\n\n      default:\n        this.prefix = '';\n        this.suggestions = [];\n    }\n    this.suggestions = this.suggestions.filter(searchFilter);\n    if (this.suggestions.length === 1) {\n      this.selected = 0;  // auto-select the only suggested item\n    } else {\n      this.selected = null;\n    }\n  }\n\n};\n\nexport default DjangoQL;\n\nwindow.DjangoQL = DjangoQL;\n"],"sourceRoot":""}