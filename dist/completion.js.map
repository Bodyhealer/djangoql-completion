{"version":3,"sources":["webpack://djangoql-completion/./node_modules/lex/lexer.js","webpack://djangoql-completion/webpack/bootstrap","webpack://djangoql-completion/webpack/runtime/compat get default export","webpack://djangoql-completion/webpack/runtime/define property getters","webpack://djangoql-completion/webpack/runtime/hasOwnProperty shorthand","webpack://djangoql-completion/webpack/runtime/node module decorator","webpack://djangoql-completion/./src/lru-cache.js","webpack://djangoql-completion/./src/index.js"],"names":["Lexer","defunct","tokens","rules","remove","scan","matches","index","state","this","lastIndex","input","i","length","rule","start","states","indexOf","pattern","result","exec","j","push","action","global","k","temple","addRule","flags","multiline","ignoreCase","RegExp","source","Object","prototype","toString","call","setInput","lex","shift","reject","splice","match","token","apply","slice","charAt","module","exports","chr","Error","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","id","loaded","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","defineProperty","enumerable","get","obj","prop","hasOwnProperty","nmd","paths","children","LRUCache","limit","size","oldest","newest","_keymap","_markEntryAsUsed","entry","newer","older","put","value","returnEntry","find","set","oldvalue","removeAll","keys","forEach","fun","context","desc","toJSON","s","Array","String","reIntValue","reExponentPart","intRegex","floatRegex","stringRegex","whitespaceRegex","lexer","name","suggestion","text","snippetBefore","snippetAfter","explanation","suggestionText","l","lexAll","end","DjangoQL","options","cacheSize","currentModel","models","suggestionsAPIUrl","prefix","suggestions","selected","valuesCaseSensitive","highlightCaseSensitive","textarea","completion","completionUL","completionEnabled","isObject","loadIntrospections","introspections","selector","document","querySelector","tagName","parseInt","logError","suggestionsCache","debouncedLoadFieldOptions","debounce","loadFieldOptions","bind","loading","enableCompletion","disableCompletion","onCompletionMouseClick","onCompletionMouseDown","popupCompletion","debouncedRenderCompletion","renderCompletion","setAttribute","addEventListener","onKeydown","hideCompletion","autoResize","textareaResize","style","resize","overflow","window","createCompletionElement","init","DOMReady","callback","readyState","syntaxHelp","createElement","className","appendChild","onscroll","throttle","onCompletionScroll","innerHTML","e","preventDefault","destroyCompletionElement","parentNode","removeChild","getJson","url","settings","onLoadError","request","abort","XMLHttpRequest","open","onload","status","success","JSON","parse","responseText","ontimeout","onerror","onprogress","setTimeout","send","initIntrospections","data","current_model","suggestions_api_url","func","wait","immediate","args","timeout","timestamp","later","last","Date","now","callNow","arguments","throttled","previous","leading","getTime","remaining","clearTimeout","trailing","cancel","setUrlParams","params","pair","parts","split","path","queryString","join","pairs","encodeURI","message","console","error","selectCompletion","currentTarget","getAttribute","keyCode","onSubmit","form","submit","getComputedStyle","heightOffset","parseFloat","paddingTop","paddingBottom","height","scrollHeight","generateSuggestions","getContext","selectionStart","currentFullToken","textValue","startPos","tokenEndPos","textBefore","textAfter","trim","snippetAfterParts","endsWith","startsWith","textToPaste","cursorPosAfter","focus","setSelectionRange","display","escapeRegExp","str","replace","highlight","dontForceDisplay","currentLi","completionRect","currentLiRect","inputRect","li","liLen","suggestionsLen","loadingElement","querySelectorAll","getBoundingClientRect","bottom","scrollTop","top","removeEventListener","pageYOffset","left","resolveName","f","nameParts","model","field","type","relation","cursorPos","whitespace","resolvedName","scope","lastToken","nextToLastToken","allTokens","pop","getCurrentFieldOptions","fieldOptions","cacheKey","isArray","loadMore","cached","requestUrl","requestParams","search","has_next","page","items","concat","populateFieldOptions","filter","item","toLowerCase","map","rectHeight","scrollBottom","searchFilter","selectionEnd","lastIndexOf","nullable"],"mappings":"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","file":"completion.js","sourcesContent":["if (typeof module === \"object\" && typeof module.exports === \"object\") module.exports = Lexer;\n\nLexer.defunct = function (chr) {\n    throw new Error(\"Unexpected character at index \" + (this.index - 1) + \": \" + chr);\n};\n\nfunction Lexer(defunct) {\n    if (typeof defunct !== \"function\") defunct = Lexer.defunct;\n\n    var tokens = [];\n    var rules = [];\n    var remove = 0;\n    this.state = 0;\n    this.index = 0;\n    this.input = \"\";\n\n    this.addRule = function (pattern, action, start) {\n        var global = pattern.global;\n\n        if (!global) {\n            var flags = \"g\";\n            if (pattern.multiline) flags += \"m\";\n            if (pattern.ignoreCase) flags += \"i\";\n            pattern = new RegExp(pattern.source, flags);\n        }\n\n        if (Object.prototype.toString.call(start) !== \"[object Array]\") start = [0];\n\n        rules.push({\n            pattern: pattern,\n            global: global,\n            action: action,\n            start: start\n        });\n\n        return this;\n    };\n\n    this.setInput = function (input) {\n        remove = 0;\n        this.state = 0;\n        this.index = 0;\n        tokens.length = 0;\n        this.input = input;\n        return this;\n    };\n\n    this.lex = function () {\n        if (tokens.length) return tokens.shift();\n\n        this.reject = true;\n\n        while (this.index <= this.input.length) {\n            var matches = scan.call(this).splice(remove);\n            var index = this.index;\n\n            while (matches.length) {\n                if (this.reject) {\n                    var match = matches.shift();\n                    var result = match.result;\n                    var length = match.length;\n                    this.index += length;\n                    this.reject = false;\n                    remove++;\n\n                    var token = match.action.apply(this, result);\n                    if (this.reject) this.index = result.index;\n                    else if (typeof token !== \"undefined\") {\n                        switch (Object.prototype.toString.call(token)) {\n                        case \"[object Array]\":\n                            tokens = token.slice(1);\n                            token = token[0];\n                        default:\n                            if (length) remove = 0;\n                            return token;\n                        }\n                    }\n                } else break;\n            }\n\n            var input = this.input;\n\n            if (index < input.length) {\n                if (this.reject) {\n                    remove = 0;\n                    var token = defunct.call(this, input.charAt(this.index++));\n                    if (typeof token !== \"undefined\") {\n                        if (Object.prototype.toString.call(token) === \"[object Array]\") {\n                            tokens = token.slice(1);\n                            return token[0];\n                        } else return token;\n                    }\n                } else {\n                    if (this.index !== index) remove = 0;\n                    this.reject = true;\n                }\n            } else if (matches.length)\n                this.reject = true;\n            else break;\n        }\n    };\n\n    function scan() {\n        var matches = [];\n        var index = 0;\n\n        var state = this.state;\n        var lastIndex = this.index;\n        var input = this.input;\n\n        for (var i = 0, length = rules.length; i < length; i++) {\n            var rule = rules[i];\n            var start = rule.start;\n            var states = start.length;\n\n            if ((!states || start.indexOf(state) >= 0) ||\n                (state % 2 && states === 1 && !start[0])) {\n                var pattern = rule.pattern;\n                pattern.lastIndex = lastIndex;\n                var result = pattern.exec(input);\n\n                if (result && result.index === lastIndex) {\n                    var j = matches.push({\n                        result: result,\n                        action: rule.action,\n                        length: result[0].length\n                    });\n\n                    if (rule.global) index = j;\n\n                    while (--j > index) {\n                        var k = j - 1;\n\n                        if (matches[j].length > matches[k].length) {\n                            var temple = matches[j];\n                            matches[j] = matches[k];\n                            matches[k] = temple;\n                        }\n                    }\n                }\n            }\n        }\n\n        return matches;\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","__webpack_require__.nmd = function(module) {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","/**\n * https://github.com/rsms/js-lru/blob/v2/lru.js\n *\n * A doubly linked list-based Least Recently Used (LRU) cache. Will keep most\n * recently used items while discarding least recently used items when its limit\n * is reached.\n *\n * Licensed under MIT. Copyright (c) 2010 Rasmus Andersson <http://hunch.se/>\n * See README.md for details.\n *\n * Illustration of the design:\n *\n *       entry             entry             entry             entry\n *       ______            ______            ______            ______\n *      | head |.newer => |      |.newer => |      |.newer => | tail |\n *      |  A   |          |  B   |          |  C   |          |  D   |\n *      |______| <= older.|______| <= older.|______| <= older.|______|\n *\n *  removed  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  added\n */\nfunction LRUCache (limit) {\n  // Current size of the cache. (Read-only).\n  this.size = 0;\n  // Maximum number of items this cache can hold.\n  this.limit = limit;\n  this.oldest = this.newest = undefined;\n  this._keymap = {};\n}\n\n\nLRUCache.prototype._markEntryAsUsed = function(entry) {\n  if (entry === this.newest) {\n    // Already the most recenlty used entry, so no need to update the list\n    return;\n  }\n  // HEAD--------------TAIL\n  //   <.older   .newer>\n  //  <--- add direction --\n  //   A  B  C  <D>  E\n  if (entry.newer) {\n    if (entry === this.oldest) {\n      this.oldest = entry.newer;\n    }\n    entry.newer.older = entry.older; // C <-- E.\n  }\n  if (entry.older) {\n    entry.older.newer = entry.newer; // C. --> E\n  }\n  entry.newer = undefined; // D --x\n  entry.older = this.newest; // D. --> E\n  if (this.newest) {\n    this.newest.newer = entry; // E. <-- D\n  }\n  this.newest = entry;\n};\n\n/**\n * Put <value> into the cache associated with <key>. Returns the entry which was\n * removed to make room for the new entry. Otherwise undefined is returned\n * (i.e. if there was enough room already).\n */\nLRUCache.prototype.put = function(key, value) {\n  var entry = this._keymap[key];\n\n  if (entry) {\n    // update existing\n    entry.value = value;\n    this._markEntryAsUsed(entry);\n    return;\n  }\n\n  // new entry\n  this._keymap[key] = entry = {key:key, value:value, older:undefined, newer:undefined};\n\n  if (this.newest) {\n    // link previous tail to the new tail (entry)\n    this.newest.newer = entry;\n    entry.older = this.newest;\n  } else {\n    // we're first in -- yay\n    this.oldest = entry;\n  }\n\n  // add new entry to the end of the linked list -- it's now the freshest entry.\n  this.newest = entry;\n  this.size++;\n  if (this.size > this.limit) {\n    // we hit the limit -- remove the head\n    return this.shift();\n  }\n};\n\n/**\n * Purge the least recently used (oldest) entry from the cache. Returns the\n * removed entry or undefined if the cache was empty.\n *\n * If you need to perform any form of finalization of purged items, this is a\n * good place to do it. Simply override/replace this function:\n *\n *   var c = new LRUCache(123);\n *   c.shift = function() {\n *     var entry = LRUCache.prototype.shift.call(this);\n *     doSomethingWith(entry);\n *     return entry;\n *   }\n */\nLRUCache.prototype.shift = function() {\n  // todo: handle special case when limit == 1\n  var entry = this.oldest;\n  if (entry) {\n    if (this.oldest.newer) {\n      // advance the list\n      this.oldest = this.oldest.newer;\n      this.oldest.older = undefined;\n    } else {\n      // the cache is exhausted\n      this.oldest = undefined;\n      this.newest = undefined;\n    }\n    // Remove last strong reference to <entry> and remove links from the purged\n    // entry being returned:\n    entry.newer = entry.older = undefined;\n    // delete is slow, but we need to do this to avoid uncontrollable growth:\n    delete this._keymap[entry.key];\n    this.size--;\n  }\n  return entry;\n};\n\n/**\n * Get and register recent use of <key>. Returns the value associated with <key>\n * or undefined if not in cache.\n */\nLRUCache.prototype.get = function(key, returnEntry) {\n  // First, find our cache entry\n  var entry = this._keymap[key];\n  if (entry === undefined) return; // Not cached. Sorry.\n  // As <key> was found in the cache, register it as being requested recently\n  this._markEntryAsUsed(entry);\n  return returnEntry ? entry : entry.value;\n};\n\n// ----------------------------------------------------------------------------\n// Following code is optional and can be removed without breaking the core\n// functionality.\n\n/**\n * Check if <key> is in the cache without registering recent use. Feasible if\n * you do not want to chage the state of the cache, but only \"peek\" at it.\n * Returns the entry associated with <key> if found, or undefined if not found.\n */\nLRUCache.prototype.find = function(key) {\n  return this._keymap[key];\n};\n\n/**\n * Update the value of entry with <key>. Returns the old value, or undefined if\n * entry was not in the cache.\n */\nLRUCache.prototype.set = function(key, value) {\n  var oldvalue, entry = this.get(key, true);\n  if (entry) {\n    oldvalue = entry.value;\n    entry.value = value;\n  } else {\n    oldvalue = this.put(key, value);\n    if (oldvalue) oldvalue = oldvalue.value;\n  }\n  return oldvalue;\n};\n\n/**\n * Remove entry <key> from cache and return its value. Returns undefined if not\n * found.\n */\nLRUCache.prototype.remove = function(key) {\n  var entry = this._keymap[key];\n  if (!entry) return;\n  delete this._keymap[entry.key]; // need to do delete unfortunately\n  if (entry.newer && entry.older) {\n    // relink the older entry with the newer entry\n    entry.older.newer = entry.newer;\n    entry.newer.older = entry.older;\n  } else if (entry.newer) {\n    // remove the link to us\n    entry.newer.older = undefined;\n    // link the newer entry to head\n    this.oldest = entry.newer;\n  } else if (entry.older) {\n    // remove the link to us\n    entry.older.newer = undefined;\n    // link the newer entry to head\n    this.newest = entry.older;\n  } else {// if(entry.older === undefined && entry.newer === undefined) {\n    this.oldest = this.newest = undefined;\n  }\n\n  this.size--;\n  return entry.value;\n};\n\n/** Removes all entries */\nLRUCache.prototype.removeAll = function() {\n  // This should be safe, as we never expose strong refrences to the outside\n  this.oldest = this.newest = undefined;\n  this.size = 0;\n  this._keymap = {};\n};\n\n/**\n * Return an array containing all keys of entries stored in the cache object, in\n * arbitrary order.\n */\nif (typeof Object.keys === 'function') {\n  LRUCache.prototype.keys = function() {\n    return Object.keys(this._keymap);\n  };\n} else {\n  LRUCache.prototype.keys = function() {\n    var keys = [];\n    for (var k in this._keymap) {\n      keys.push(k);\n    }\n    return keys;\n  };\n}\n\n/**\n * Call `fun` for each entry. Starting with the newest entry if `desc` is a true\n * value, otherwise starts with the oldest (head) enrty and moves towards the\n * tail.\n *\n * `fun` is called with 3 arguments in the context `context`:\n *   `fun.call(context, Object key, Object value, LRUCache self)`\n */\nLRUCache.prototype.forEach = function(fun, context, desc) {\n  var entry;\n  if (context === true) {\n    desc = true;\n    context = undefined;\n  } else if (typeof context !== 'object') {\n    context = this;\n  }\n  if (desc) {\n    entry = this.newest;\n    while (entry) {\n      fun.call(context, entry.key, entry.value, this);\n      entry = entry.older;\n    }\n  } else {\n    entry = this.oldest;\n    while (entry) {\n      fun.call(context, entry.key, entry.value, this);\n      entry = entry.newer;\n    }\n  }\n};\n\n/** Returns a JSON (array) representation */\nLRUCache.prototype.toJSON = function() {\n  var s = new Array(this.size), i = 0, entry = this.oldest;\n  while (entry) {\n    s[i++] = { key: entry.key, value: entry.value };\n    entry = entry.newer;\n  }\n  return s;\n};\n\n/** Returns a String representation */\nLRUCache.prototype.toString = function() {\n  var s = '', entry = this.oldest;\n  while (entry) {\n    s += String(entry.key)+':'+entry.value;\n    entry = entry.newer;\n    if (entry) {\n      s += ' < ';\n    }\n  }\n  return s;\n};\n\n// Export ourselves\nexport default LRUCache;\n","import Lexer from 'lex';\nimport LRUCache from './lru-cache';\n\nvar reIntValue = '(-?0|-?[1-9][0-9]*)';\nvar reFractionPart = '\\\\.[0-9]+';\nvar reExponentPart = '[eE][+-]?[0-9]+';\nvar intRegex = new RegExp(reIntValue);\nvar floatRegex = new RegExp(\n    reIntValue + reFractionPart + reExponentPart + '|' +\n    reIntValue + reFractionPart + '|' +\n    reIntValue + reExponentPart);\nvar reLineTerminators = '\\\\n\\\\r\\\\u2028\\\\u2029';\nvar reEscapedChar = '\\\\\\\\[\\\\\\\\\"/bfnrt]';\nvar reEscapedUnicode = '\\\\\\\\u[0-9A-Fa-f]{4}';\nvar reStringChar = '[^\\\\\"\\\\\\\\' + reLineTerminators + ']';\nvar stringRegex = new RegExp(\n    '\\\\\"(' + reEscapedChar +\n    '|' + reEscapedUnicode +\n    '|' + reStringChar + ')*\\\\\"');\nvar nameRegex = /[_A-Za-z][_0-9A-Za-z]*(\\.[_A-Za-z][_0-9A-Za-z]*)*/;\nvar reNotFollowedByName = '(?![_0-9A-Za-z])';\nvar whitespaceRegex = /[ \\t\\v\\f\\u00A0]+/;\n\nvar lexer = new Lexer(function () {\n  // Silently swallow any lexer errors\n});\n\nfunction token(name, value) {\n  return { name: name, value: value };\n}\n\nlexer.addRule(whitespaceRegex, function () { /* ignore whitespace */ });\nlexer.addRule(/\\./, function (l) { return token('DOT', l); });\nlexer.addRule(/,/, function (l) { return token('COMMA', l); });\nlexer.addRule(new RegExp('or' + reNotFollowedByName), function (l) {\n  return token('OR', l);\n});\nlexer.addRule(new RegExp('and' + reNotFollowedByName), function (l) {\n  return token('AND', l);\n});\nlexer.addRule(new RegExp('not' + reNotFollowedByName), function (l) {\n  return token('NOT', l);\n});\nlexer.addRule(new RegExp('in' + reNotFollowedByName), function (l) {\n  return token('IN', l);\n});\nlexer.addRule(new RegExp('True' + reNotFollowedByName), function (l) {\n  return token('TRUE', l);\n});\nlexer.addRule(new RegExp('False' + reNotFollowedByName), function (l) {\n  return token('FALSE', l);\n});\nlexer.addRule(new RegExp('None' + reNotFollowedByName), function (l) {\n  return token('NONE', l);\n});\nlexer.addRule(nameRegex, function (l) { return token('NAME', l); });\nlexer.addRule(stringRegex, function (l) {\n  // Trim leading and trailing quotes\n  return token('STRING_VALUE', l.slice(1, l.length - 1));\n});\nlexer.addRule(intRegex, function (l) { return token('INT_VALUE', l); });\nlexer.addRule(floatRegex, function (l) { return token('FLOAT_VALUE', l); });\nlexer.addRule(/\\(/, function (l) { return token('PAREN_L', l); });\nlexer.addRule(/\\)/, function (l) { return token('PAREN_R', l); });\nlexer.addRule(/=/, function (l) { return token('EQUALS', l); });\nlexer.addRule(/!=/, function (l) { return token('NOT_EQUALS', l); });\nlexer.addRule(/>/, function (l) { return token('GREATER', l); });\nlexer.addRule(/>=/, function (l) { return token('GREATER_EQUAL', l); });\nlexer.addRule(/</, function (l) { return token('LESS', l); });\nlexer.addRule(/<=/, function (l) { return token('LESS_EQUAL', l); });\nlexer.addRule(/~/, function (l) { return token('CONTAINS', l); });\nlexer.addRule(/!~/, function (l) { return token('NOT_CONTAINS', l); });\nlexer.lexAll = function () {\n  var match;\n  var result = [];\n  while (match = this.lex()) {  // eslint-disable-line no-cond-assign\n    match.start = this.index - match.value.length;\n    match.end = this.index;\n    result.push(match);\n  }\n  return result;\n};\n\nfunction suggestion(text, snippetBefore, snippetAfter, explanation) {\n  // text is being displayed in completion box and pasted when you hit Enter.\n  // snippetBefore is an optional extra text to be pasted before main text.\n  // snippetAfter is an optional text to be pasted after. It may also include\n  // \"|\" symbol to designate desired cursor position after paste.\n  var suggestionText = text;\n  if (typeof explanation !== 'undefined') {\n    suggestionText += '<i>' + explanation + '</i>';\n  }\n\n  return {\n    text: text,\n    snippetBefore: snippetBefore || '',\n    snippetAfter: snippetAfter || '',\n    suggestionText: suggestionText\n  };\n}\n\n// Main DjangoQL object\nvar DjangoQL = function (options) {\n  var cacheSize = 100;\n\n  this.options = options;\n  this.currentModel = null;\n  this.models = {};\n  this.suggestionsAPIUrl = null;\n\n  this.token = token;\n  this.lexer = lexer;\n\n  this.prefix = '';\n  this.suggestions = [];\n  this.selected = null;\n  this.valuesCaseSensitive = false;\n  this.highlightCaseSensitive = true;\n\n  this.textarea = null;\n  this.completion = null;\n  this.completionUL = null;\n  this.completionEnabled = false;\n\n  // Initialization\n  if (!this.isObject(options)) {\n    this.logError('Please pass an object with initialization parameters');\n    return;\n  }\n  this.loadIntrospections(options.introspections);\n  if (typeof options.selector === 'string') {\n    this.textarea = document.querySelector(options.selector);\n  } else {\n    this.textarea = options.selector;\n  }\n  if (!this.textarea) {\n    this.logError('Element not found by selector: ' + options.selector);\n    return;\n  }\n  if (this.textarea.tagName !== 'TEXTAREA') {\n    this.logError('selector must be pointing to <textarea> element, but ' +\n        this.textarea.tagName + ' was found');\n    return;\n  }\n  if (options.valuesCaseSensitive) {\n    this.valuesCaseSensitive = true;\n  }\n  if (options.cacheSize) {\n    if (parseInt(options.cacheSize, 10) !== options.cacheSize\n        || options.cacheSize < 1) {\n      this.logError('cacheSize must be a positive integer');\n    } else {\n      cacheSize = options.cacheSize;\n    }\n  }\n  this.suggestionsCache = new LRUCache(cacheSize);\n  this.debouncedLoadFieldOptions = this.debounce(\n    this.loadFieldOptions.bind(this),\n    300);\n  this.loading = false;\n\n  this.enableCompletion = this.enableCompletion.bind(this);\n  this.disableCompletion = this.disableCompletion.bind(this);\n\n  // these handlers are re-used more than once in the code below,\n  // so it's handy to have them already bound\n  this.onCompletionMouseClick = this.onCompletionMouseClick.bind(this);\n  this.onCompletionMouseDown = this.onCompletionMouseDown.bind(this);\n  this.popupCompletion = this.popupCompletion.bind(this);\n  this.debouncedRenderCompletion = this.debounce(\n      this.renderCompletion.bind(this),\n      50);\n\n  // Bind event handlers and initialize completion & textSize containers\n  this.textarea.setAttribute('autocomplete', 'off');\n  this.textarea.addEventListener('keydown', this.onKeydown.bind(this));\n  this.textarea.addEventListener('blur', this.hideCompletion.bind(this));\n  this.textarea.addEventListener('click', this.popupCompletion);\n  if (options.autoResize) {\n    this.textareaResize = this.textareaResize.bind(this);\n    this.textarea.style.resize = 'none';\n    this.textarea.style.overflow = 'hidden';\n    this.textarea.addEventListener('input', this.textareaResize);\n    this.textareaResize();\n    // There could be a situation when fonts are not loaded yet at this\n    // point. When fonts are finally loaded it could make textarea looking\n    // weird - for example in Django 1.9+ last line won't fit. To fix this\n    // we call .textareaResize() once again when window is fully loaded.\n    window.addEventListener('load', this.textareaResize);\n  } else {\n    this.textareaResize = null;\n    // Catch resize events and re-position completion box.\n    // See http://stackoverflow.com/a/7055239\n    this.textarea.addEventListener(\n        'mouseup', this.renderCompletion.bind(this, true));\n    this.textarea.addEventListener(\n        'mouseout', this.renderCompletion.bind(this, true));\n  }\n\n  this.createCompletionElement();\n};\n\n// Backward compatibility\nDjangoQL.init = function (options) {\n  return new DjangoQL(options);\n};\n\nDjangoQL.DOMReady = function (callback) {\n  if (document.readyState !== 'loading') {\n    callback();\n  } else {\n    document.addEventListener('DOMContentLoaded', callback);\n  }\n};\n\nDjangoQL.prototype = {\n  createCompletionElement: function () {\n    var options = this.options;\n    var syntaxHelp;\n\n    if (!this.completion) {\n      this.completion = document.createElement('div');\n      this.completion.className = 'djangoql-completion';\n      document.querySelector('body').appendChild(this.completion);\n      this.completionUL = document.createElement('ul');\n      this.completionUL.onscroll = this.throttle(\n        this.onCompletionScroll.bind(this),\n        50);\n      this.completion.appendChild(this.completionUL);\n      if (typeof options.syntaxHelp === 'string') {\n        syntaxHelp = document.createElement('p');\n        syntaxHelp.className = 'syntax-help';\n        syntaxHelp.innerHTML = '<a href=\"' + options.syntaxHelp +\n            '\" target=\"_blank\">Syntax Help</a>';\n        syntaxHelp.addEventListener('mousedown', function (e) {\n          // This is needed to prevent conflict with textarea.onblur event\n          // handler, which tries to hide the completion box and therefore\n          // makes Syntax Help link malfunctional.\n          e.preventDefault();\n        });\n        this.completion.appendChild(syntaxHelp);\n      }\n\n      this.completionEnabled = options.hasOwnProperty('completionEnabled') ?\n        options.completionEnabled :\n        true;\n    }\n  },\n\n  destroyCompletionElement: function () {\n    if (this.completion) {\n      this.completion.parentNode.removeChild(this.completion);\n      this.completion = null;\n      this.completionEnabled = false;\n    }\n  },\n\n  enableCompletion: function () {\n    this.completionEnabled = true;\n  },\n\n  disableCompletion: function () {\n    this.completionEnabled = false;\n    this.hideCompletion();\n  },\n\n  getJson: function (url, settings) {\n    this.loading = true;\n\n    var onLoadError = function () {\n      this.loading = false;\n      this.request = null;\n      this.logError('failed to fetch from ' + url);\n    }.bind(this);\n\n    if (this.request) {\n      this.request.abort();\n    }\n    this.request = new XMLHttpRequest();\n\n    this.request.open('GET', url, true);\n    this.request.onload = function () {\n      this.loading = false;\n      if (this.request.status === 200) {\n        if (typeof settings.success === 'function') {\n          settings.success(JSON.parse(this.request.responseText));\n        }\n      } else {\n        onLoadError();\n      }\n      this.request = null;\n    }.bind(this);\n    this.request.ontimeout = onLoadError;\n    this.request.onerror = onLoadError;\n    /* eslint-disable max-len */\n    // Workaround for IE9, see\n    // https://cypressnorth.com/programming/internet-explorer-aborting-ajax-requests-fixed/\n    /* eslint-enable max-len */\n    this.request.onprogress = function () {};\n    window.setTimeout(this.request.send.bind(this.request));\n  },\n\n  loadIntrospections: function (introspections) {\n    var initIntrospections = function (data) {\n      this.currentModel = data.current_model;\n      this.models = data.models;\n      this.suggestionsAPIUrl = data.suggestions_api_url;\n    }.bind(this);\n\n    if (typeof introspections === 'string') {\n      // treat as URL\n      this.getJson(introspections, { success: initIntrospections });\n    } else if (this.isObject(introspections)) {\n      initIntrospections(introspections);\n    } else {\n      this.logError(\n          'introspections parameter is expected to be either URL or ' +\n          'object with definitions, but ' + introspections + ' was found');\n    }\n  },\n\n  isObject: function (obj) {\n    return (({}).toString.call(obj) === '[object Object]');\n  },\n\n  debounce: function (func, wait, immediate) {\n    // Borrowed from Underscore.js\n    var args;\n    var context;\n    var result;\n    var timeout;\n    var timestamp;\n\n    var later = function () {\n      var last = Date.now() - timestamp;\n      if (last < wait && last >= 0) {\n        timeout = setTimeout(later, wait - last);\n      } else {\n        timeout = null;\n        if (!immediate) {\n          result = func.apply(context, args);\n          if (!timeout) {\n            args = null;\n            context = null;\n          }\n        }\n      }\n    };\n\n    return function () {\n      var callNow;\n      context = this;\n      args = arguments;\n      timestamp = Date.now();\n      callNow = immediate && !timeout;\n      if (!timeout) timeout = setTimeout(later, wait);\n      if (callNow) {\n        result = func.apply(context, args);\n        args = null;\n        context = null;\n      }\n      return result;\n    };\n  },\n\n  throttle: function (func, wait, options) {\n    // Borrowed from Underscore.js\n    var timeout;\n    var context;\n    var args;\n    var result;\n    var previous = 0;\n    var later;\n    var throttled;\n\n    if (!options) {\n      options = {};\n    }\n\n    later = function () {\n      previous = options.leading === false ? 0 : new Date().getTime();\n      timeout = null;\n      result = func.apply(context, args);\n      if (!timeout) {\n        context = null;\n        args = null;\n      }\n    };\n\n    throttled = function () {\n      var now = new Date().getTime();\n      var remaining;\n\n      if (!previous && options.leading === false) {\n        previous = now;\n      }\n      remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          window.clearTimeout(timeout);\n          timeout = null;\n        }\n        previous = now;\n        result = func.apply(context, args);\n        if (!timeout) {\n          context = null;\n          args = null;\n        }\n      } else if (!timeout && options.trailing !== false) {\n        timeout = window.setTimeout(later, remaining);\n      }\n      return result;\n    };\n\n    throttled.cancel = function () {\n      window.clearTimeout(timeout);\n      previous = 0;\n      timeout = null;\n      context = null;\n      args = null;\n    };\n\n    return throttled;\n  },\n\n  setUrlParams: function (url, params) {\n    var parts = url.split('?');\n    var path = parts[0];\n    var queryString = parts.slice(1).join('?');\n    var pairs = queryString.split('&');\n    var pair;\n    var key;\n    var value;\n    var i;\n\n    for (key in params) {\n      if (params.hasOwnProperty(key)) {\n        key = encodeURI(key);\n        value = encodeURI(params[key]);\n        i = pairs.length;\n        while (i--) {\n          pair = pairs[i].split('=');\n          if (pair[0] === key) {\n            pair[1] = value;\n            pairs[i] = pair.join('=');\n            break;\n          }\n        }\n        if (i < 0) {\n          pairs.push(key + '=' + value);\n        }\n      }\n    }\n    queryString = pairs.join('&');\n    return queryString ? [path, queryString].join('?') : path;\n  },\n\n  logError: function (message) {\n    console.error('DjangoQL: ' + message);  // eslint-disable-line no-console\n  },\n\n  onCompletionMouseClick: function (e) {\n    this.selectCompletion(\n      parseInt(e.currentTarget.getAttribute('data-index'), 10)\n    );\n  },\n\n  onCompletionMouseDown: function (e) {\n    // This is needed to prevent 'blur' event on textarea\n    e.preventDefault();\n  },\n\n  onKeydown: function (e) {\n    switch (e.keyCode) {\n      case 38:  // up arrow\n        if (this.suggestions.length) {\n          if (this.selected === null) {\n            this.selected = this.suggestions.length - 1;\n          } else if (this.selected === 0) {\n            this.selected = null;\n          } else {\n            this.selected -= 1;\n          }\n          this.renderCompletion();\n          e.preventDefault();\n        }\n        break;\n\n      case 40:  // down arrow\n        if (this.suggestions.length) {\n          if (this.selected === null) {\n            this.selected = 0;\n          } else if (this.selected < this.suggestions.length - 1) {\n            this.selected += 1;\n          } else {\n            this.selected = null;\n          }\n          this.renderCompletion();\n          e.preventDefault();\n        }\n        break;\n\n      case 9:   // Tab\n        if (this.selected !== null) {\n          this.selectCompletion(this.selected);\n          e.preventDefault();\n        }\n        break;\n\n      case 13:  // Enter\n        if (this.selected !== null) {\n          this.selectCompletion(this.selected);\n        } else {\n          // Technically this is a textarea, due to automatic multi-line\n          // feature, but other than that it should look and behave like\n          // a normal input. So expected behavior when pressing Enter is\n          // to submit the form, not to add a new line.\n          if (typeof this.options.onSubmit === 'function') {\n            this.options.onSubmit(this.textarea.value);\n          } else {\n            e.currentTarget.form.submit();\n          }\n        }\n        e.preventDefault();\n        break;\n\n      case 27:  // Esc\n        this.hideCompletion();\n        break;\n\n      case 16:  // Shift\n      case 17:  // Ctrl\n      case 18:  // Alt\n      case 91:  // Windows Key or Left Cmd on Mac\n      case 93:  // Windows Menu or Right Cmd on Mac\n        // Control keys shouldn't trigger completion popup\n        break;\n\n      default:\n        // When keydown is fired input value has not been updated yet,\n        // so we need to wait\n        window.setTimeout(this.popupCompletion, 10);\n        break;\n    }\n  },\n\n  textareaResize: function () {\n    // Automatically grow/shrink textarea to have the contents always visible\n    var style = window.getComputedStyle(this.textarea, null);\n    var heightOffset = parseFloat(style.paddingTop) +\n        parseFloat(style.paddingBottom);\n    this.textarea.style.height = '5px';\n    // dirty hack, works for Django admin styles only.\n    // Ping me if you know how to get rid of \"+1\"\n    this.textarea.style.height = (this.textarea.scrollHeight - heightOffset) +\n        1 + 'px';\n  },\n\n  popupCompletion: function () {\n    this.generateSuggestions();\n    this.renderCompletion();\n  },\n\n  selectCompletion: function (index) {\n    var context = this.getContext(\n      this.textarea.value,\n      this.textarea.selectionStart\n    );\n    var currentFullToken = context.currentFullToken;\n    var textValue = this.textarea.value;\n    var startPos = this.textarea.selectionStart - context.prefix.length;\n    var tokenEndPos = null;\n\n    // cutting current token from the string\n    if (currentFullToken) {\n      tokenEndPos = currentFullToken.end;\n      textValue = (\n        textValue.slice(0, startPos) + textValue.slice(tokenEndPos)\n      );\n    }\n\n    var textBefore = textValue.slice(0, startPos);\n    var textAfter = textValue.slice(startPos);\n    // preventing double spaces after pasting the suggestion\n    textAfter = textAfter.trim();\n\n    var completion = this.suggestions[index];\n    var snippetBefore = completion.snippetBefore;\n    var snippetAfter = completion.snippetAfter;\n    var snippetAfterParts = snippetAfter.split('|');\n    if (snippetAfterParts.length > 1) {\n      snippetAfter = snippetAfterParts.join('');\n      if (!snippetBefore && !completion.text) {\n        snippetBefore = snippetAfterParts[0];\n        snippetAfter = snippetAfterParts[1];\n      }\n    }\n    if (textBefore.endsWith(snippetBefore)) {\n      snippetBefore = '';\n    }\n    if (textAfter.startsWith(snippetAfter)) {\n      snippetAfter = '';\n    }\n    var textToPaste = snippetBefore + completion.text + snippetAfter;\n    var cursorPosAfter = textBefore.length + textToPaste.length;\n    if (snippetAfterParts.length > 1) {\n      cursorPosAfter -= snippetAfterParts[1].length;\n    }\n\n    this.textarea.value = textBefore + textToPaste + textAfter;\n    this.textarea.focus();\n    this.textarea.setSelectionRange(cursorPosAfter, cursorPosAfter);\n    this.selected = null;\n    if (this.textareaResize) {\n      this.textareaResize();\n    }\n    this.generateSuggestions(this.textarea);\n    this.renderCompletion();\n  },\n\n  hideCompletion: function () {\n    this.selected = null;\n    if (this.completion) {\n      this.completion.style.display = 'none';\n    }\n  },\n\n  escapeRegExp: function (str) {\n    // http://stackoverflow.com\n    // /questions/3446170/escape-string-for-use-in-javascript-regex\n    return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');  // eslint-disable-line\n  },\n\n  highlight: function (text, highlight) {\n    if (!highlight || !text) {\n      return text;\n    } else if (this.highlightCaseSensitive) {\n      return text.split(highlight).join('<b>' + highlight + '</b>');\n    }\n    return text.replace(\n        new RegExp('(' + this.escapeRegExp(highlight) + ')', 'ig'),\n        '<b>$1</b>');\n  },\n\n  renderCompletion: function (dontForceDisplay) {\n    var currentLi;\n    var i;\n    var completionRect;\n    var currentLiRect;\n    var inputRect;\n    var li;\n    var liLen;\n    var suggestionsLen;\n    var loadingElement;\n\n    if (!this.completionEnabled) {\n      this.hideCompletion();\n      return;\n    }\n\n    if (dontForceDisplay && this.completion.style.display === 'none') {\n      return;\n    }\n    if (!this.suggestions.length && !this.loading) {\n      this.hideCompletion();\n      return;\n    }\n\n    suggestionsLen = this.suggestions.length;\n    li = [].slice.call(this.completionUL.querySelectorAll('li[data-index]'));\n    liLen = li.length;\n\n    // Update or create necessary elements\n    for (i = 0; i < suggestionsLen; i++) {\n      if (i < liLen) {\n        currentLi = li[i];\n      } else {\n        currentLi = document.createElement('li');\n        currentLi.setAttribute('data-index', i);\n        currentLi.addEventListener('click', this.onCompletionMouseClick);\n        currentLi.addEventListener('mousedown', this.onCompletionMouseDown);\n        this.completionUL.appendChild(currentLi);\n      }\n      currentLi.innerHTML = this.highlight(\n          this.suggestions[i].suggestionText,\n          this.prefix);\n      if (i === this.selected) {\n        currentLi.className = 'active';\n        currentLiRect = currentLi.getBoundingClientRect();\n        completionRect = this.completionUL.getBoundingClientRect();\n        if (currentLiRect.bottom > completionRect.bottom) {\n          this.completionUL.scrollTop = this.completionUL.scrollTop + 2 +\n              (currentLiRect.bottom - completionRect.bottom);\n        } else if (currentLiRect.top < completionRect.top) {\n          this.completionUL.scrollTop = this.completionUL.scrollTop - 2 -\n              (completionRect.top - currentLiRect.top);\n        }\n      } else {\n        currentLi.className = '';\n      }\n    }\n    // Remove redundant elements\n    while (liLen > suggestionsLen) {\n      liLen--;\n      li[liLen].removeEventListener('click', this.onCompletionMouseClick);\n      li[liLen].removeEventListener('mousedown', this.onCompletionMouseDown);\n      this.completionUL.removeChild(li[liLen]);\n    }\n\n    loadingElement = this.completionUL.querySelector('li.djangoql-loading');\n\n    if (this.loading) {\n      if (!loadingElement) {\n        loadingElement = document.createElement('li');\n        loadingElement.className = 'djangoql-loading';\n        loadingElement.innerHTML = '&nbsp;';\n        this.completionUL.appendChild(loadingElement);\n      }\n    } else if (loadingElement) {\n      this.completionUL.removeChild(loadingElement);\n    }\n\n    inputRect = this.textarea.getBoundingClientRect();\n    this.completion.style.top = window.pageYOffset + inputRect.top +\n        inputRect.height + 'px';\n    this.completion.style.left = inputRect.left + 'px';\n    this.completion.style.display = 'block';\n  },\n\n  resolveName: function (name) {\n    // Walk through introspection definitions and get target model and field\n    var f;\n    var i;\n    var l;\n    var nameParts = name.split('.');\n    var model = this.currentModel;\n    var field = null;\n\n    if (model) {\n      for (i = 0, l = nameParts.length; i < l; i++) {\n        f = this.models[model][nameParts[i]];\n        if (!f) {\n          model = null;\n          field = null;\n          break;\n        } else if (f.type === 'relation') {\n          model = f.relation;\n          field = null;\n        } else {\n          field = nameParts[i];\n        }\n      }\n    }\n    return { model: model, field: field };\n  },\n\n  getContext: function (text, cursorPos) {\n    // This function returns an object with the following 4 properties:\n    var prefix;        // text already entered by user in the current scope\n    var scope = null;  // 'field', 'comparison', 'value', 'logical' or null\n    var model = null;  // model, set for 'field', 'comparison' and 'value'\n    var field = null;  // field, set for 'comparison' and 'value'\n\n    var whitespace;\n    var nameParts;\n    var resolvedName;\n    var lastToken = null;\n    var nextToLastToken = null;\n    var tokens = this.lexer.setInput(text.slice(0, cursorPos)).lexAll();\n    var allTokens = this.lexer.setInput(text).lexAll();\n    var currentFullToken = null;\n    if (tokens.length && tokens[tokens.length - 1].end >= cursorPos) {\n      // if cursor is positioned on the last token then remove it.\n      // We are only interested in tokens preceding current.\n      currentFullToken = allTokens[tokens.length - 1];\n      tokens.pop();\n    }\n    if (tokens.length) {\n      lastToken = tokens[tokens.length - 1];\n      if (tokens.length > 1) {\n        nextToLastToken = tokens[tokens.length - 2];\n      }\n    }\n\n    // Current token which is currently being typed may be not complete yet,\n    // so lexer may fail to recognize it correctly. So we define current token\n    // prefix as a string without whitespace positioned after previous token\n    // and until current cursor position.\n    prefix = text.slice(lastToken ? lastToken.end : 0, cursorPos);\n    whitespace = prefix.match(whitespaceRegex);\n    if (whitespace) {\n      prefix = prefix.slice(whitespace[0].length);\n    }\n    if (prefix === '(') {\n      // Paren should not be a part of suggestion\n      prefix = '';\n    }\n\n    if (prefix === ')' && !whitespace) {\n      // Nothing to suggest right after right paren\n    } else if (!lastToken ||\n        (['AND', 'OR'].indexOf(lastToken.name) >= 0 && whitespace) ||\n        (prefix === '.' && lastToken && !whitespace) ||\n        (lastToken.name === 'PAREN_L' && (!nextToLastToken ||\n            ['AND', 'OR'].indexOf(nextToLastToken.name) >= 0))) {\n      scope = 'field';\n      model = this.currentModel;\n      if (prefix === '.') {\n        prefix = text.slice(lastToken.start, cursorPos);\n      }\n      nameParts = prefix.split('.');\n      if (nameParts.length > 1) {\n        // use last part as a prefix, analyze preceding parts to get the model\n        prefix = nameParts.pop();\n        resolvedName = this.resolveName(nameParts.join('.'));\n        if (resolvedName.model && !resolvedName.field) {\n          model = resolvedName.model;\n        } else {\n          // if resolvedName.model is null that means that model wasn't found.\n          // if resolvedName.field is NOT null that means that the name\n          // preceding current prefix is a concrete field and not a relation,\n          // and therefore it can't have any properties.\n          scope = null;\n          model = null;\n        }\n      }\n    } else if (lastToken && whitespace &&\n        nextToLastToken && nextToLastToken.name === 'NAME' &&\n        ['EQUALS', 'NOT_EQUALS', 'CONTAINS', 'NOT_CONTAINS', 'GREATER_EQUAL',\n          'GREATER', 'LESS_EQUAL', 'LESS'].indexOf(lastToken.name) >= 0) {\n      resolvedName = this.resolveName(nextToLastToken.value);\n      if (resolvedName.model) {\n        scope = 'value';\n        model = resolvedName.model;\n        field = resolvedName.field;\n        if (prefix[0] === '\"' && (this.models[model][field].type === 'str'\n            || this.models[model][field].options)) {\n          prefix = prefix.slice(1);\n        }\n      }\n    } else if (lastToken && whitespace && lastToken.name === 'NAME') {\n      resolvedName = this.resolveName(lastToken.value);\n      if (resolvedName.model) {\n        scope = 'comparison';\n        model = resolvedName.model;\n        field = resolvedName.field;\n      }\n    } else if (lastToken && whitespace &&\n        ['PAREN_R', 'INT_VALUE', 'FLOAT_VALUE', 'STRING_VALUE']\n            .indexOf(lastToken.name) >= 0) {\n      scope = 'logical';\n    }\n    return {\n      prefix: prefix,\n      scope: scope,\n      model: model,\n      field: field,\n      currentFullToken: currentFullToken\n    };\n  },\n\n  getCurrentFieldOptions: function () {\n    var input = this.textarea;\n    var context = this.getContext(input.value, input.selectionStart);\n    var model = this.models[context.model];\n    var field = context.field && model[context.field];\n    var fieldOptions = {\n      cacheKey: null,\n      context: context,\n      field: field,\n      model: model,\n      options: null\n    };\n\n    if (context.scope !== 'value' || !field || !field.options) {\n      return null;\n    }\n    if (Array.isArray(field.options)) {\n      fieldOptions.options = field.options;\n    } else if (field.options === true) {\n      // Means get via API\n      if (!this.suggestionsAPIUrl) {\n        return null;\n      }\n      fieldOptions.cacheKey = context.model + '.' + context.field\n        + '|' + context.prefix;\n    }\n    return fieldOptions;\n  },\n\n  loadFieldOptions: function (loadMore) {\n    var fieldOptions = this.getCurrentFieldOptions() || {};\n    var context = fieldOptions.context;\n    var cached;\n    var requestUrl;\n    var requestParams;\n\n    if (!fieldOptions.cacheKey) {\n      // The context has likely changed, user's cursor is in another position\n      return;\n    }\n    requestParams = {\n      field: context.model + '.' + context.field,\n      search: context.prefix\n    };\n\n    cached = this.suggestionsCache.get(fieldOptions.cacheKey) || {};\n    if (loadMore && cached.has_next) {\n      requestParams.page = cached.page ? cached.page + 1 : 1;\n    } else if (cached.page) {\n      // At least the first page is already loaded\n      return;\n    }\n\n    cached.loading = true;\n    this.suggestionsCache.set(fieldOptions.cacheKey, cached);\n\n    requestUrl = this.setUrlParams(this.suggestionsAPIUrl, requestParams);\n    this.getJson(requestUrl, {\n      success: function (data) {\n        var cached = this.suggestionsCache.get(fieldOptions.cacheKey) || {};\n        if (data.page - 1 !== (cached.page || 0)) {\n          // either pages were loaded out of order,\n          // or cache is no longer exists\n          return;\n        }\n        data.items = (cached.items || []).concat(data.items);\n        this.suggestionsCache.set(fieldOptions.cacheKey, data);\n        this.loading = false;\n        this.populateFieldOptions();\n        this.renderCompletion();\n      }.bind(this)\n    });\n    // Render 'loading' element\n    this.populateFieldOptions();\n    this.renderCompletion();\n  },\n\n  populateFieldOptions: function (loadMore) {\n    var fieldOptions = this.getCurrentFieldOptions();\n    if (fieldOptions === null) {\n      // 1) we are out of field options context\n      // 2) field has no options\n      return;\n    }\n    var options = fieldOptions.options;\n    var prefix = fieldOptions.context && fieldOptions.context.prefix;\n    var cached;\n\n    if (options) {\n      // filter them locally\n      if (this.valuesCaseSensitive) {\n        options = options.filter(function (item) {\n          // Case-sensitive\n          return item.indexOf(prefix) >= 0;\n        });\n      } else {\n        options = options.filter(function (item) {\n          // Case-insensitive\n          return item.toLowerCase().indexOf(prefix.toLowerCase()) >= 0;\n        });\n      }\n    } else {\n      this.suggestions = [];\n      if (!fieldOptions.cacheKey) {\n        return;\n      }\n      cached = this.suggestionsCache.get(fieldOptions.cacheKey) || {};\n      options = cached.items || [];\n      if (!cached.loading\n          && (!cached.page || (loadMore && cached.has_next))) {\n        this.debouncedLoadFieldOptions(loadMore);\n      }\n      if (!options.length) {\n        // Should we show 'no results' message?\n        return;\n      }\n    }\n\n    this.highlightCaseSensitive = this.valuesCaseSensitive;\n    this.suggestions = options.map(function (f) {\n      return suggestion(f, '\"', '\"');\n    });\n  },\n\n  onCompletionScroll: function () {\n    var rectHeight = this.completionUL.getBoundingClientRect().height;\n    var scrollBottom = this.completionUL.scrollTop + rectHeight;\n    if (scrollBottom > rectHeight\n        && scrollBottom > (this.completionUL.scrollHeight - rectHeight)) {\n      // TODO: add some checks of context?\n      this.populateFieldOptions(true);\n    }\n  },\n\n  generateSuggestions: function () {\n    var input = this.textarea;\n    var context;\n    var model;\n    var field;\n    var suggestions;\n    var snippetAfter;\n    var searchFilter;\n\n    if (!this.completionEnabled) {\n      this.prefix = '';\n      this.suggestions = [];\n      return;\n    }\n\n    if (!this.currentModel) {\n      // Introspections are not loaded yet\n      return;\n    }\n    if (input.selectionStart !== input.selectionEnd) {\n      // We shouldn't show suggestions when something is selected\n      this.prefix = '';\n      this.suggestions = [];\n      return;\n    }\n\n    // default search filter - find anywhere in the string, case-sensitive\n    searchFilter = function (item) {\n      return item.text.indexOf(this.prefix) >= 0;\n    }.bind(this);\n    // default highlight mode - case sensitive\n    this.highlightCaseSensitive = true;\n\n    context = this.getContext(input.value, input.selectionStart);\n    this.prefix = context.prefix;\n    model = this.models[context.model];\n    field = context.field && model[context.field];\n\n    switch (context.scope) {\n      case 'field':\n        this.suggestions = Object.keys(model).map(function (f) {\n          return suggestion(f, '', model[f].type === 'relation' ? '.' : ' ');\n        });\n        break;\n\n      case 'comparison':\n        suggestions = ['=', ['!=', 'is not equal to']];\n        snippetAfter = ' ';\n        if (field && field.type !== 'bool') {\n          if (['str', 'date', 'datetime'].indexOf(field.type) >= 0) {\n            suggestions.push(['~', 'contains']);\n            suggestions.push(['!~', 'does not contain']);\n            snippetAfter = ' \"|\"';\n          } else if (field.options) {\n            snippetAfter = ' \"|\"';\n          }\n          if (field.type !== 'str') {\n            Array.prototype.push.apply(suggestions, ['>', '>=', '<', '<=']);\n          }\n        }\n        this.suggestions = suggestions.map(function (s) {\n          if (typeof s === 'string') {\n            return suggestion(s, '', snippetAfter);\n          } else {\n            return suggestion(s[0], '', snippetAfter, s[1]);\n          }\n        });\n        if (field && field.type !== 'bool') {\n          if (['str', 'date', 'datetime'].indexOf(field.type) >= 0\n              || field.options) {\n            snippetAfter = ' (\"|\")';\n          } else {\n            snippetAfter = ' (|)';\n          }\n          this.suggestions.push(suggestion('in', '', snippetAfter));\n          this.suggestions.push(suggestion('not in', '', snippetAfter));\n        }\n        // use \"starts with\" search filter instead of default\n        searchFilter = function (item) {\n          // See http://stackoverflow.com/a/4579228\n          return item.text.lastIndexOf(this.prefix, 0) === 0;\n        }.bind(this);\n        break;\n\n      case 'value':\n        if (!field) {\n          // related field\n          this.suggestions = [suggestion('None', '', ' ')];\n        } else if (field.options) {\n          this.prefix = context.prefix;\n          this.populateFieldOptions();\n        } else if (field.type === 'bool') {\n          this.suggestions = [\n            suggestion('True', '', ' '),\n            suggestion('False', '', ' ')\n          ];\n          if (field.nullable) {\n            this.suggestions.push(suggestion('None', '', ' '));\n          }\n        } else if (field.type === 'unknown') {\n          // unknown field type, reset suggestions\n          this.prefix = '';\n          this.suggestions = [];\n        }\n        break;\n\n      case 'logical':\n        this.suggestions = [\n          suggestion('and', '', ' '),\n          suggestion('or', '', ' ')\n        ];\n        break;\n\n      default:\n        this.prefix = '';\n        this.suggestions = [];\n    }\n    this.suggestions = this.suggestions.filter(searchFilter);\n    if (this.suggestions.length === 1) {\n      this.selected = 0;  // auto-select the only suggested item\n    } else {\n      this.selected = null;\n    }\n  }\n\n};\n\nexport default DjangoQL;\n\nwindow.DjangoQL = DjangoQL;\n"],"sourceRoot":""}